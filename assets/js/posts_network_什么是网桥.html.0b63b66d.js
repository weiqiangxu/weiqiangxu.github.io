"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2532],{6262:(i,s)=>{s.A=(i,s)=>{const a=i.__vccOpts||i;for(const[i,n]of s)a[i]=n;return a}},4854:(i,s,a)=>{a.r(s),a.d(s,{comp:()=>t,data:()=>e});var n=a(641);const l={},t=(0,a(6262).A)(l,[["render",function(i,s){return(0,n.uX)(),(0,n.CE)("div",null,s[0]||(s[0]=[(0,n.Fv)('<blockquote><p>理解什么是网桥、路由，如何应用，了解docker的网络模型</p></blockquote><h3 id="_1-网桥的创建" tabindex="-1"><a class="header-anchor" href="#_1-网桥的创建"><span>1.网桥的创建</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 安装 bridge-utils 包，它包含了配置网桥所需的工具</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bridge-utils</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建网桥</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># sudo brctl addbr &lt;bridge-name&gt;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> brctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> addbr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> my-net</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将物理接口添加到网桥中</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># sudo brctl addif &lt;bridge-name&gt; &lt;physical-interface&gt;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> brctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> addif</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> my-net</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lo</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将名为 &quot;my-net&quot; 的网络接口（network interface）启用（up）</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># sudo ip link set dev &lt;bridge-name&gt; up</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> my-net</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ifconfig 可以查看到 my-net 网桥</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看网桥的状态以及连接到网桥上的接口</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> brctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> show</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-删除网桥" tabindex="-1"><a class="header-anchor" href="#_2-删除网桥"><span>2.删除网桥</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看网桥</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> brctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> show</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 停止网桥</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ifconfig &lt;bridge-name&gt; down</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ifconfig</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> my-net</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> down</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 删除网桥</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># brctl delbr &lt;bridge-name&gt;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> brctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> delbr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> my-netm</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-典型的网桥应用" tabindex="-1"><a class="header-anchor" href="#_3-典型的网桥应用"><span>3.典型的网桥应用</span></a></h3><ol><li>bridge模式下的docker，会创建虚拟网桥docker0；</li><li>给每个容器分配私有IP；</li><li>私有IP地址（通常是172.17.x.x）映射到宿主机的公共IP地址 -- 实现容器与宿主机之间通信；</li><li>容器会连接到该虚拟网桥docker0 -- 实现容器之间的通信；</li></ol><blockquote><p>Docker会创建一对veth设备，其中一个连接到容器，另一个连接到Docker宿主机的Linux桥接设备中了；</p></blockquote><p>验证docker在bridge模式下:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 安装docker</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 18.09.0</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 运行nginx服务</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx-test</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 网络接口</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ifconfig</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">             # 虚拟网桥</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">enp1s0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">              # 物理网卡</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lo</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                  # 环回网卡</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">veth71942f7</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         # veth71942f7是docker创建的虚拟网卡设备，用于容器与宿主机之间的通信</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">virbr0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">              # virbr0是libvirt创建的虚拟网桥设备，用于在虚拟机之间提供网络通信</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 所谓路由就是指示了各个ip下的数据包的走向，具体走向到哪个网卡由路由决定</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@i-7B581709 ~]# ip route</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 默认路由，即所有未知目的地的数据包将通过enp1s0网卡发送到网关10.16.207.254上</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">default</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> via</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10.16.207.254</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enp1s0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> proto</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dhcp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> metric</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                  </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 子网路由，指示10.16.200.0/21的数据包将被发送到enp1s0网卡，源IP地址为10.16.203.189</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">10.16.200.0/21</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enp1s0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> proto</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kernel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scope</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> src</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10.16.203.189</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> metric</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 链接范围的本地路由，指示数据包将在enp1s0网卡上本地处理</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 169.254.0.0/16是私有IP地址范围，通常为本地网络自动配置保留</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">169.254.0.0/16</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enp1s0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scope</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 容器网络路由</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 指示所有172.17.0.0/16的数据包将被发送到docker0虚拟桥接口，并使用源IP地址172.17.0.1</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">172.17.0.0/16</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> proto</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kernel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scope</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> src</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 172.17.0.1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># virbr0虚拟网桥的路由，该路由无效，因为该接口已经下线（linkdown），所以无法路由任何数据包</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">192.168.122.0/24</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> virbr0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> proto</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kernel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scope</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> src</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 192.168.122.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> linkdown</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看容器网络地址</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inspect</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx-test</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    {</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;NetworkSettings&quot;: {</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            &quot;Bridge&quot;: &quot;&quot;,</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            &quot;Ports&quot;: {</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                &quot;80/tcp&quot;: null</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            },</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,      </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 容器网关</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 容器IP地址</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            &quot;IPPrefixLen&quot;: 16,</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            &quot;Networks&quot;: {</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                &quot;bridge&quot;: {</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                    &quot;IPPrefixLen&quot;: 16,</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                }</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            }</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        }</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    }</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">]</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># arp 找 mac 地址，然后icmp</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ping</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 172.17.0.2</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看和管理网络设备的邻居表的命令</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 显示和管理 IPv4 和 IPv6 地址之间的转换、ARP 地址解析协议、NDP 邻居发现协议等内容</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 显示当前主机的网络路由表和 ARP 缓存表，包括 IP 地址到 MAC 地址的映射关系</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> n</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">172.17.0.2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lladdr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 02:42:ac:11:00:02</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> STALE</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">10.16.207.254</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enp1s0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lladdr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6c:e5:f7:6b:79:61</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DELAY</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">169.254.169.254</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enp1s0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lladdr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fe:ff:ff:ff:ff:ff</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> REACHABLE</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># docker内部网络列表</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> network</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ls</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NETWORK</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ID</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          NAME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                DRIVER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              SCOPE</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">71e49c08add7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        bridge</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              bridge</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              local</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ec4c0f0642bd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        host</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                host</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                local</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0750ef78e913</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        none</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                null</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                local</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看网桥</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> brctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> show</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bridge</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     bridge</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> id</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">               STP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enabled</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     interfaces</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         8000.024257229552</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       no</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              veth71942f7</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # 容器与宿主机之间的通信</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">virbr0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          8000.5254003c195a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       yes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             virbr0-nic</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 虚拟机之间提供网络通信</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># bridge模式下</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># docker daemon守护进程会创建一对对等虚拟设备接口 veth pair</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将其中一个接口设置为容器的 eth0 接口（容器的网卡）</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 另一个接口放置在宿主机的命名空间中，以类似 vethxxx 这样的名字命名，从而将宿主机上的所有容器都连接到这个内部网络上</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 从网桥 docker0 的私有地址空间中分配一个 IP 地址和子网给该容器</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 并设置 docker0 的 IP 地址为容器的默认网关</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看bridge模式下的容器</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> network</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inspect</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bridge</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`{</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   &quot;Containers&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      &quot;f554d6ebfc496a20ed6ac0644d2b4f49bab12536ac446a86485f43516c942e93&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            &quot;Name&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;nginx-test&quot;,</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            &quot;EndpointID&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;xxx&quot;,</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            &quot;MacAddress&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;02:42:ac:11:00:02&quot;,</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            &quot;IPv4Address&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;172.17.0.2/16&quot;,</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            &quot;IPv6Address&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      }</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   }</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">}`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>docker 之中部署了一个nginx，那么访问该nginx服务，数据走向是怎么样的，经历了多少个网卡：</p><ol><li>路由表来看，目标IP地址172.17.0.2属于172.17.0.0/16子网，数据包会被发送到docker0接口上;</li><li>数据包被Docker虚拟网络处理，最终被路由到与容器172.17.0.2对应的网络命名空间中，从而到达容器内部;</li></ol><p><img src="/images/docker-bridge.png" alt="docker bridge下网络模式" loading="lazy"><img src="/images/docker-host.webp" alt="docker host的网络模式" loading="lazy"></p><h3 id="q-a" tabindex="-1"><a class="header-anchor" href="#q-a"><span>Q&amp;A</span></a></h3><h5 id="_1-将网络接口-网卡-添加到网桥之中会怎么样" tabindex="-1"><a class="header-anchor" href="#_1-将网络接口-网卡-添加到网桥之中会怎么样"><span>1.将网络接口(网卡)添加到网桥之中会怎么样</span></a></h5><ol><li>将网卡加入网桥，该网卡可以接收和转发网桥中其他网络设备（包括其他网卡、虚拟机等）发送的数据包。</li><li>该网卡也可以向网桥中的其他设备发送数据包，从而实现网络通信。</li><li>通过使用网桥，可以在不同的网络设备之间进行透明的通信，就像它们直接相连一样.</li></ol><blockquote><p>同一个网桥的设备之间可以通信；</p></blockquote><h5 id="_2-sudo-brctl-addif-my-net-eth0-这句话什么意思-lo的流量会怎么走" tabindex="-1"><a class="header-anchor" href="#_2-sudo-brctl-addif-my-net-eth0-这句话什么意思-lo的流量会怎么走"><span>2.sudo brctl addif my-net eth0 这句话什么意思，lo的流量会怎么走</span></a></h5><ul><li>将 &quot;eth0&quot; 的物理网络接口（network interface）添加到名为 &quot;my-net&quot; 的 Linux 桥接器（bridge）上。</li><li>&quot;eth0&quot; 的网络流量转发到该桥接器上，以便与其他连接到该桥接器的设备进行通信。</li></ul><h5 id="_3-网络接口lo流量走向" tabindex="-1"><a class="header-anchor" href="#_3-网络接口lo流量走向"><span>3.网络接口lo流量走向</span></a></h5><ul><li>系统上的本地回环接口（loopback interface）；</li><li>同一系统内部发送和接收数据包；</li><li>lo的流量不会通过该桥接器或任何其他物理网络接口，直接在内核中传递，计算机内部进行循环传输；</li></ul><h5 id="_4-docker容器是net-none的-可以直接访问容器内部吗" tabindex="-1"><a class="header-anchor" href="#_4-docker容器是net-none的-可以直接访问容器内部吗"><span>4.docker容器是net=none的，可以直接访问容器内部吗</span></a></h5><p>如果将容器的网络类型设置为net=none，那么容器将完全没有网络访问权限，无论是从容器内部访问外部网络，还是从外部网络访问容器内部的服务都不可能实现。</p><h5 id="_5-docker的网络类型有哪些" tabindex="-1"><a class="header-anchor" href="#_5-docker的网络类型有哪些"><span>5.docker的网络类型有哪些</span></a></h5><p>bridge或者host模式，默认使用的是bridge网络模，在bridge网络模式下，容器的IP地址是通过NAT(Network Address Translation，网络地址转换)进行转换的，所以从容器外部无法直接访问容器内部的IP地址。 Docker daemon创建的docker0虚拟网桥，会为每个容器分配一个私有的IP地址。 当容器需要与外部网络通信时，容器的私有IP地址会被NAT为宿主机的IP地址，并通过宿主机上的网络接口与外部网络通信。 这样可以让多个容器共享一个宿主机的公网IP地址，从而节省公网IP地址的使用。</p><h5 id="_6-docker的nat是什么" tabindex="-1"><a class="header-anchor" href="#_6-docker的nat是什么"><span>6.Docker的NAT是什么</span></a></h5><ol><li>NAT（Network Address Translation）NAT功能通过Linux内核的iptables实现；</li><li>将Docker容器中的私有IP地址（通常是172.17.x.x）映射到宿主机的公共IP地址上，实现容器和宿主机之间的通信；</li><li>当容器访问外部网络时，Docker将数据包NAT处理，私有IP地址替换为宿主机的公共IP地址，以实现容器和外部网络之间的通信；</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iptables</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nat</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -L</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 下面是docker NAT 输出规则</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 目的是实现docker容器访问外部网络</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将来自172.17.0.0/16网段的所有数据包的源地址改为主机的IP地址</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 并将它们发送到目的地0.0.0.0/0</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Chain</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> POSTROUTING</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (policy </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ACCEPT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">target</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     prot</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> opt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> source</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">               destination</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">         </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MASQUERADE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  all</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  172.17.0.0/16</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        0.0.0.0/0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">‘</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 至于访问外部网络可以直接走路由规则将所有172.17.0.0/16网段数据包发172.17.0.1</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 也就是docker0网桥</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">172.17.0.0/16</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> proto</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kernel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scope</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> src</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 172.17.0.1</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># docker网桥</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker0:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> inet</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 172.17.0.1/16</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> scope</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> global</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker0</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># docker0网桥上插着每个容器网络命名空间的网卡的pair对端网卡</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> brctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> show</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bridge</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     bridge</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> id</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">               STP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enabled</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     interfaces</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">br1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             8000.62429a077f4c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       no</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              veth1</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">br2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             8000.aa0bfb51ea56</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       no</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              veth3</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         8000.024236ffee25</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       no</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              veth0c7094b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                                        veth40a4dc5(nginx2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                                                        vethdbe644d(nginx3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_7-docker的网络类型bridge和host有什么区别" tabindex="-1"><a class="header-anchor" href="#_7-docker的网络类型bridge和host有什么区别"><span>7.docker的网络类型bridge和host有什么区别</span></a></h5><ol><li>Bridge网络类型是Docker默认的网络类型，而Host网络类型是指容器直接使用宿主机的网络，不会进行网络隔离。</li><li>Bridge网络类型在容器和宿主机之间建立虚拟网络，容器之间可以通过容器名或者IP地址相互通信，但是容器和宿主机之间需要映射端口才能通信。</li><li>Host网络类型直接使用宿主机的网络，容器可以直接访问宿主机的所有端口和网络设备，但是容器之间的网络隔离失效。</li><li>Bridge网络类型可以使用Docker内置的DNS服务来访问其他容器的服务，而Host网络类型需要使用宿主机的DNS服务来访问其他服务。</li><li>Bridge网络类型可以使用Docker内置的端口映射来将容器内部的端口映射到宿主机的端口，从而实现容器与外部的通信。而Host网络类型不需要进行端口映射，直接使用宿主机的端口即可。</li></ol><h5 id="_8-ip-a和ifconfig有什么区别" tabindex="-1"><a class="header-anchor" href="#_8-ip-a和ifconfig有什么区别"><span>8.<code>ip a</code>和<code>ifconfig</code>有什么区别</span></a></h5><p>都是用来显示系统网络配置信息的命令:</p><ol><li>ip a是较新的命令，能够显示更丰富的网络信息，包括IPv4和IPv6地址、MAC地址等，而ifconfig只能显示IPv4地址和MAC地址。</li><li>ip a命令在处理网络配置时更加灵活，支持更多的网络参数设置，而ifconfig则不支持。</li><li>ip a命令输出的信息更易于理解和解析，而ifconfig输出的信息比较混乱，需要进行额外的处理才可读。</li></ol><h5 id="_9-veth-pair技术" tabindex="-1"><a class="header-anchor" href="#_9-veth-pair技术"><span>9.veth pair技术</span></a></h5><ul><li>veth pair 技术是一种网络虚拟化技术，它能够创建一对虚拟的网络设备（veth pair），这对设备之间通过一个虚拟的网络连接在一起。</li><li>每个 veth pair 都包含两个端点，一个端点被称为veth0，另一个端点被称为veth1，它们可以被分别连接到不同的网络命名空间中。</li><li>veth pair 技术通常被用于实现容器网络，因为它可以使容器中的应用程序共享主机系统的网络设备，而不必在容器中运行一个独立的网络堆栈。</li></ul><h5 id="_10-nat功能通过linux内核的iptables实现" tabindex="-1"><a class="header-anchor" href="#_10-nat功能通过linux内核的iptables实现"><span>10.NAT功能通过Linux内核的iptables实现</span></a></h5><ol><li>Network Address Translation (NAT) 功能可以通过 Linux 内核的 iptables 工具来实现。</li><li>但不是NAT都是需要用iptables实现，除了iptables，iproute2工具集中的ip命令可以用于配置和管理网络地址转换。</li><li>如netfilter和conntrack等，也可以在Linux系统上实现高级的NAT功能。</li></ol><h5 id="_11-网桥相关概念" tabindex="-1"><a class="header-anchor" href="#_11-网桥相关概念"><span>11.网桥相关概念</span></a></h5><ol><li>网桥（Bridge）可用于连接两个或多个网络段，使其成为一个逻辑局域网（LAN）。</li><li>OSI模型的第二层，即数据链路层（MAC地址）。它通过学习和转发数据包的MAC地址来实现网络段之间的通信。</li><li>基本原理：当数据包到达网桥的一个接口，网桥会依据数据包的目的MAC地址，并将其发送到与该目的地址相应的接口上。</li><li>根据MAC地址进行转发，而不是根据IP地址，网桥可以在一个局域网中连接不同的IP子网。</li></ol><h3 id="相关资料" tabindex="-1"><a class="header-anchor" href="#相关资料"><span>相关资料</span></a></h3><p><a href="https://zhuanlan.zhihu.com/p/293659939#" target="_blank" rel="noopener noreferrer">linux veth pair详解</a><a href="https://zhuanlan.zhihu.com/p/557146190" target="_blank" rel="noopener noreferrer">6 张图详解 Docker 容器网络配置</a></p>',41)]))}]]),e=JSON.parse('{"path":"/posts/network/%E4%BB%80%E4%B9%88%E6%98%AF%E7%BD%91%E6%A1%A5.html","title":"什么是网桥","lang":"zh-CN","frontmatter":{"title":"什么是网桥","tags":["docker"],"categories":["docker"],"description":"理解什么是网桥、路由，如何应用，了解docker的网络模型 1.网桥的创建 2.删除网桥 3.典型的网桥应用 bridge模式下的docker，会创建虚拟网桥docker0； 给每个容器分配私有IP； 私有IP地址（通常是172.17.x.x）映射到宿主机的公共IP地址 -- 实现容器与宿主机之间通信； 容器会连接到该虚拟网桥docker0 -- 实现...","gitInclude":[],"head":[["meta",{"property":"og:url","content":"https://weiqiangxu.github.io/posts/network/%E4%BB%80%E4%B9%88%E6%98%AF%E7%BD%91%E6%A1%A5.html"}],["meta",{"property":"og:site_name","content":"QuickStart程序员"}],["meta",{"property":"og:title","content":"什么是网桥"}],["meta",{"property":"og:description","content":"理解什么是网桥、路由，如何应用，了解docker的网络模型 1.网桥的创建 2.删除网桥 3.典型的网桥应用 bridge模式下的docker，会创建虚拟网桥docker0； 给每个容器分配私有IP； 私有IP地址（通常是172.17.x.x）映射到宿主机的公共IP地址 -- 实现容器与宿主机之间通信； 容器会连接到该虚拟网桥docker0 -- 实现..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://weiqiangxu.github.io/images/docker-bridge.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:tag","content":"docker"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"什么是网桥\\",\\"image\\":[\\"https://weiqiangxu.github.io/images/docker-bridge.png\\",\\"https://weiqiangxu.github.io/images/docker-host.webp\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"xuweiqiang\\",\\"url\\":\\"https://weiqiangxu.github.io\\"}]}"]]},"headers":[{"level":3,"title":"1.网桥的创建","slug":"_1-网桥的创建","link":"#_1-网桥的创建","children":[]},{"level":3,"title":"2.删除网桥","slug":"_2-删除网桥","link":"#_2-删除网桥","children":[]},{"level":3,"title":"3.典型的网桥应用","slug":"_3-典型的网桥应用","link":"#_3-典型的网桥应用","children":[]},{"level":3,"title":"Q&A","slug":"q-a","link":"#q-a","children":[]},{"level":3,"title":"相关资料","slug":"相关资料","link":"#相关资料","children":[]}],"readingTime":{"minutes":9.9,"words":2969},"filePathRelative":"posts/network/什么是网桥.md","excerpt":"<blockquote>\\n<p>理解什么是网桥、路由，如何应用，了解docker的网络模型</p>\\n</blockquote>\\n<h3>1.网桥的创建</h3>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" data-title=\\"bash\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 安装 bridge-utils 包，它包含了配置网桥所需的工具</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> yum</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> install</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> bridge-utils</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 创建网桥</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># sudo brctl addbr &lt;bridge-name&gt;</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> sudo</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> brctl</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> addbr</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> my-net</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 将物理接口添加到网桥中</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># sudo brctl addif &lt;bridge-name&gt; &lt;physical-interface&gt;</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> sudo</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> brctl</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> addif</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> my-net</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> lo</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 将名为 \\"my-net\\" 的网络接口（network interface）启用（up）</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># sudo ip link set dev &lt;bridge-name&gt; up</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> link</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> set</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> dev</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> my-net</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> up</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># ifconfig 可以查看到 my-net 网桥</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 查看网桥的状态以及连接到网桥上的接口</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> brctl</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> show</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}')}}]);