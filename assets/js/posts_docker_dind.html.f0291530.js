"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1910],{6262:(e,i)=>{i.A=(e,i)=>{const t=e.__vccOpts||e;for(const[e,s]of i)t[e]=s;return t}},1120:(e,i,t)=>{t.r(i),t.d(i,{comp:()=>n,data:()=>d});var s=t(641);const a={},n=(0,t(6262).A)(a,[["render",function(e,i){return(0,s.uX)(),(0,s.CE)("div",null,i[0]||(i[0]=[(0,s.Fv)('<h3 id="什么是dind" tabindex="-1"><a class="header-anchor" href="#什么是dind"><span>什么是dind</span></a></h3><blockquote><p>kubernetes的编译需要用到dind，就是docker内部启动一个容器用于编译镜像，在gitlab的CI的时候可以使用</p></blockquote><ol><li>官网</li></ol><p><a href="https://github.com/jpetazzo/dind" target="_blank" rel="noopener noreferrer">https://github.com/jpetazzo/dind</a><a href="https://hub.docker.com/_/docker/tags?page=1&amp;name=dind" target="_blank" rel="noopener noreferrer">DockerHub上面dind的文档</a><a href="https://docker-practice.github.io/zh-cn/image/dockerfile/entrypoint.html" target="_blank" rel="noopener noreferrer">ENTRYPOINT 入口点</a></p><ol start="2"><li>quick start</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --privileged</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker:dind</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="相关疑问" tabindex="-1"><a class="header-anchor" href="#相关疑问"><span>相关疑问</span></a></h3><ul><li>dind有时候会抛出异常 docker.daemon 程序未开启</li></ul><p>是因为<code>docker run</code>会导致镜像名后面的是 command，运行时会替换 CMD 的默认值，也就是 <code>/usr/local/bin/dockerd-entrypoint.sh</code> 没有执行启动docker服务导致。当手动执行该脚本时候又可以在容器内看到docker的服务已经启动。</p><ul><li>在 sh 执行到<code>docker buildx build</code>构建镜像的时候 <code>FROM xxx.com/alpine:latest</code> 抛出异常如何解决</li></ul><p>需要在 <code>docker buildx create --config /etc/buildkit/buildkitd.toml --append --driver-opt network=host --use</code>创建builder实例，需要指定共享主机网络，否则会出现域名无法识别的情况。</p><ul><li>docker buildx create 创建builder如何指定配置</li></ul><p>使用 <code>docker buildx create --config path/to/config.toml</code>指定配置设置</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">registry.&quot;registry.tencent.net&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    http = true</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    insecure = true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以防止出现SSL验证错误的问题</p><ul><li>runner的内部容器执行 go mod 拉取go私有库依赖错误如何解决</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --global</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> url.&quot;git@gitlab.mine.net:&quot;.insteadOf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;https://gitlab.mine.net/&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>docker buildx create 共享主机网络怎么设置</li><li>gitlab-ci.yml之中怎么获取当前git库分支名称</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $CI_COMMIT_REF_NAME</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>helm cm-push 如何安装和添加repo</li></ul>',20)]))}]]),d=JSON.parse('{"path":"/posts/docker/dind.html","title":"dind","lang":"zh-CN","frontmatter":{"title":"dind","category":["docker"],"tag":["docker"],"description":"什么是dind kubernetes的编译需要用到dind，就是docker内部启动一个容器用于编译镜像，在gitlab的CI的时候可以使用 官网 https://github.com/jpetazzo/dind DockerHub上面dind的文档 ENTRYPOINT 入口点 quick start 相关疑问 dind有时候会抛出异常 docker...","gitInclude":[],"head":[["meta",{"property":"og:url","content":"https://weiqiangxu.github.io/posts/docker/dind.html"}],["meta",{"property":"og:site_name","content":"笔记本"}],["meta",{"property":"og:title","content":"dind"}],["meta",{"property":"og:description","content":"什么是dind kubernetes的编译需要用到dind，就是docker内部启动一个容器用于编译镜像，在gitlab的CI的时候可以使用 官网 https://github.com/jpetazzo/dind DockerHub上面dind的文档 ENTRYPOINT 入口点 quick start 相关疑问 dind有时候会抛出异常 docker..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:tag","content":"docker"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"dind\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"xuweiqiang\\",\\"url\\":\\"https://weiqiangxu.github.io\\"}]}"]]},"headers":[{"level":3,"title":"什么是dind","slug":"什么是dind","link":"#什么是dind","children":[]},{"level":3,"title":"相关疑问","slug":"相关疑问","link":"#相关疑问","children":[]}],"readingTime":{"minutes":1.22,"words":365},"filePathRelative":"posts/docker/dind.md","excerpt":"<h3>什么是dind</h3>\\n<blockquote>\\n<p>kubernetes的编译需要用到dind，就是docker内部启动一个容器用于编译镜像，在gitlab的CI的时候可以使用</p>\\n</blockquote>\\n<ol>\\n<li>官网</li>\\n</ol>\\n<p><a href=\\"https://github.com/jpetazzo/dind\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://github.com/jpetazzo/dind</a>\\n<a href=\\"https://hub.docker.com/_/docker/tags?page=1&amp;name=dind\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">DockerHub上面dind的文档</a>\\n<a href=\\"https://docker-practice.github.io/zh-cn/image/dockerfile/entrypoint.html\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">ENTRYPOINT 入口点</a></p>","autoDesc":true}')}}]);