"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[548],{6262:(s,i)=>{i.A=(s,i)=>{const a=s.__vccOpts||s;for(const[s,n]of i)a[s]=n;return a}},893:(s,i,a)=>{a.r(i),a.d(i,{comp:()=>h,data:()=>t});var n=a(641);const l={},h=(0,a(6262).A)(l,[["render",function(s,i){return(0,n.uX)(),(0,n.CE)("div",null,i[0]||(i[0]=[(0,n.Fv)('<blockquote><p>详细描述pod内无法访问apiserver cluster ip的时候的问题排查</p></blockquote><h3 id="一、问题描述" tabindex="-1"><a class="header-anchor" href="#一、问题描述"><span>一、问题描述</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> svc</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NAME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">           TYPE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        CLUSTER-IP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    EXTERNAL-IP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   PORT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">S</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)        </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">AGE</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">kubernetes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     ClusterIP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   10.96.0.1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">non</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;        </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">443/TCP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        3d23h</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">loki-service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   NodePort</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    10.96.167.4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">non</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;        </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">80:30009/TCP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   37h</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看service详细</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> describe</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> svc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubernetes</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Name:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              kubernetes</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Namespace:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         default</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Labels:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            component=apiserver</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">                   provider</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">kubernetes</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Annotations:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">non</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Selector:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">non</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Type:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              ClusterIP</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">IP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Family</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Policy:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  SingleStack</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">IP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Families:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       IPv4</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">IP:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                10.96.0.1</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">IPs:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">               10.96.0.1</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Port:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              https</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  443/TCP</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">TargetPort:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        6443/TCP</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Endpoints:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         10.16.203.160:6443</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 端点，表示这个Service对应的backend后台pod服务端点</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Session</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Affinity:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  None</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Events:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">non</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 进入pod无法访问</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -it</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test-nginx-deployment-ff8c6f675-fjq4l</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sdn-1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /bin/sh</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> curl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.96.0.1:443</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 没有任何输出表示无法连接</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 这一行是正常情况会输出的，但是没有输出 `Client sent an HTTP request to an HTTPS server.`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二、通信原理" tabindex="-1"><a class="header-anchor" href="#二、通信原理"><span>二、通信原理</span></a></h3><p>在 pod nginx 之中curl service of kubernetes的 cluster IP，最终会指向 service 的 Endpoints ，也就是说本质上是 pod 与 Endpoints无法连通，继续追踪他们之间的数据流走向。</p><ul><li>1.查看svc of kubernetes的Endpoint <code>kubectl describe svc kubernetes</code></li><li>2.pod的IP可以找到该pod所在的网络接口(需要到pod所在的宿主机才能看到该网络接口)，例如 <code>ovs-vsctl show</code> or <code>ifconfig</code></li><li>3.对pod的网络接口(网卡)进行抓包，该网卡的数据是否发送出去</li><li>4.nginx pod对应的网卡 if2090037512165 在网桥 br0 上面，此时找出网卡 if2090037512165 最终流向是物理网卡 br-ext上面的 enp1s0</li><li>5.那么对物理网卡 enp1s0 进行抓包，可以看到 pod的流量最终是否已经发送出去</li><li>6.在这里如果看到是物理网卡的配置出错了，问题排查结束</li></ul><blockquote><p>通信的大致流程是: 容器POD -&gt; 网络接口eth1 -&gt; 网桥br0 (SDN虚拟网卡所在) -&gt; 网桥 br-ext (傻瓜式网桥分配了物理网卡) -&gt; 网络接口ens1</p></blockquote><h3 id="二、q-a" tabindex="-1"><a class="header-anchor" href="#二、q-a"><span>二、Q&amp;A</span></a></h3><ol><li>如何查看pod对应的网卡是哪个</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 获取 pod ip</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test-nginx-deployment-ff8c6f675-2w4d6</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sdn-1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wide</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 获取pod ip对应的网卡</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nic</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 192.100.0.31</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>指令ip a 和ip route和ifconfig有什么区别</li></ul><ol start="2"><li>tcpdump如何监听网卡eth1以及添加过滤条件</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tcpdump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -nei</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> br-ext</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> host</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10.16.203.160</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> host</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10.16.203.161</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li>当前的拓扑图是什么</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看当前的网络接口（网卡）和网桥</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-vsctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> show</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">039d1355-682e-490f-ad61-f41ab452a83f</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Bridge</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> br-ext</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;enp1s0&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;enp1s0&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eth-ext</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eth-ext</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> br-ext</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> br-ext</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> internal</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Bridge</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;br0&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 表示当前已经连接控制器,其实就是SDN POD的地址</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Controller</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;tcp:127.0.0.1:6632&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            is_connected:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        fail_mode:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secure</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if1210073dc80a9&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if1210073dc80a9&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if05000a8c7a14a&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if05000a8c7a14a&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;br0&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;br0&quot;</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> internal</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if19100bcc04d54&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if19100bcc04d54&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if1350034b52b93&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if1350034b52b93&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eth-int</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eth-int</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>当前无法连接apiserver的pod的ip</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test-nginx-deployment-ff8c6f675-2w4d6</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sdn-1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wide</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 详细的pod信息输出</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NAME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                    READY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   STATUS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    RESTARTS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   AGE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   IP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             NODE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       NOMINATED</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NODE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   READINESS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> GATES</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">test-nginx-deployment-ff8c6f675-2w4d6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   1/1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     Running</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          4d</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    192.100.0.30</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   k8s-node</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">non</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;           &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">non</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>如何查看pod的ip对应的网络接口是哪个</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 所有网络接口（nic）中</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 筛选出IP地址为192.100.0.31的网络接口</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nic</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 192.100.0.31</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 找出pod test-nginx-deployment-ff8c6f675-jmglr 使用的网络接口是 if2090037512165</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">kube-system</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   192.100.0.31-vpc-default</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    test-nginx-deployment-ff8c6f675-fjq4l</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            if2090037512165</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 这个网络接口是 if2090037512165 ,那么pod的流量是经过 if2090037512165出去的，之后经过网桥</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 那么对 网络接口 if2090037512165 进行抓包可以看到这个 pod的流量最终的走向</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 那么如何对网络接口 if2090037512165 进行抓包呢</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 1.需要进入 pod test-nginx-deployment-ff8c6f675-2w4d6 所在的节点</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ssh</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root@k8s-node</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ifconfig</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">eth-int:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flags=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4163</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">UP,BROADCAST,RUNNING,MULTICAS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">T&gt;  </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mtu</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1500</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        inet6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fe80::68aa:aeff:fe46:f6a6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  prefixlen</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 64</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  scopeid</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0x20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">lin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">k&gt;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ether</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6a:aa:ae:46:f6:a6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  txqueuelen</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  (Ethernet)</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        RX</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 16668713</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  bytes</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2776010709</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (2.5 </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">GiB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        RX</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> errors</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  dropped</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  overruns</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  frame</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        TX</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 686</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  bytes</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 162881</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (159.0 </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">KiB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        TX</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> errors</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  dropped</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> overruns</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  carrier</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  collisions</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">if2090037512165(网络接口名称</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">): </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">flags</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">4163</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">UP</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> (接口的当前状态</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),BROADCAST(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">是否支持广播</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),RUNNING(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">是否运行</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),MULTICAST&gt; (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">是否支持多播</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  mtu 1500</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        inet6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fe80::fc00:37ff:fe51:2165</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (分配给接口的IPv6地址)  prefixlen 64  scopeid 0x20&lt;link&gt;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ether</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fe:00:37:51:21:65</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (接口的MAC地址)  txqueuelen 1000  (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Ethernet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # RX 和 TX 计数器：它们表示接受和发送的数据包数量和字节数</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        RX</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  bytes</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0.0 </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        RX</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> errors</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  dropped</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  overruns</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  frame</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        TX</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packets</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  bytes</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0.0 </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">B</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        TX</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> errors</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  dropped</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> overruns</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  carrier</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  collisions</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 那么此时可以查看到当前的网卡(网络接口) if2090037512165 详细情况</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 在非 k8s-node 节点则没有这个网络接口</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ifconfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> if2090037512165</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 没有输出</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 抓包命令</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tcpdump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -nei</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> if2090037512165</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dropped</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> privs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tcpdump</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tcpdump:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> verbose</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> output</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> suppressed,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> use</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> or</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -vv</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> full</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> protocol</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> decode</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">listening</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> if2090037512165,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link-type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EN10MB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (Ethernet), capture size 262144 bytes</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 新开另一个窗口</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -it</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test-nginx-deployment-ff8c6f675-fjq4l</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sdn-1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /bin/sh</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># curl svc of kubernetes&#39;s cluster ip</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> curl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.96.0.1:443</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Client</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sent</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> an</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HTTP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> request</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> an</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HTTPS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> server.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 此时listen的输出</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14:35:24.745030</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> d0:00:37:51:21:65</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">fe:ff:ff:ff:ff:ff,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ethertype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IPv4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0800), length 74: 192.100.0.31.41560 &gt; 10.16.203.160.sun-sr-https: Flags [S], seq 1572642610, win 64240, options [mss 1460,sackOK,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2923462901</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 0,nop,wscale 7], length 0</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14:35:24.745319</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fe:ff:ff:ff:ff:ff</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">d0:00:37:51:21:65,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ethertype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IPv4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0800), length 74: 10.16.203.160.sun-sr-https &gt; 192.100.0.31.41560: Flags [S.], seq 4252626572, ack 1572642611, win 65160, options [mss 1460,sackOK,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">535621017</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 2923462901,nop,wscale 7], length 0</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14:35:24.745357</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> d0:00:37:51:21:65</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">fe:ff:ff:ff:ff:ff,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ethertype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IPv4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0800), length 66: 192.100.0.31.41560 &gt; 10.16.203.160.sun-sr-https: Flags [.], ack 1, win 502, options [nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2923462901</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 535621017], length 0</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14:35:24.745408</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> d0:00:37:51:21:65</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">fe:ff:ff:ff:ff:ff,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ethertype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IPv4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0800), length 143: 192.100.0.31.41560 &gt; 10.16.203.160.sun-sr-https: Flags [P.], seq 1:78, ack 1, win 502, options [nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2923462901</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 535621017], length 77</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14:35:24.745514</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fe:ff:ff:ff:ff:ff</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">d0:00:37:51:21:65,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ethertype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IPv4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0800), length 66: 10.16.203.160.sun-sr-https &gt; 192.100.0.31.41560: Flags [.], ack 78, win 509, options [nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">535621017</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 2923462901], length 0</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14:35:24.745640</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fe:ff:ff:ff:ff:ff</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">d0:00:37:51:21:65,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ethertype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IPv4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0800), length 142: 10.16.203.160.sun-sr-https &gt; 192.100.0.31.41560: Flags [P.], seq 1:77, ack 78, win 509, options [nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">535621017</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 2923462901], length 76</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14:35:24.745662</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> d0:00:37:51:21:65</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">fe:ff:ff:ff:ff:ff,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ethertype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IPv4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0800), length 66: 192.100.0.31.41560 &gt; 10.16.203.160.sun-sr-https: Flags [.], ack 77, win 502, options [nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2923462901</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 535621017], length 0</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14:35:24.745712</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fe:ff:ff:ff:ff:ff</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">d0:00:37:51:21:65,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ethertype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IPv4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0800), length 66: 10.16.203.160.sun-sr-https &gt; 192.100.0.31.41560: Flags [F.], seq 77, ack 78, win 509, options [nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">535621017</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 2923462901], length 0</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14:35:24.745755</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> d0:00:37:51:21:65</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">fe:ff:ff:ff:ff:ff,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ethertype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IPv4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0800), length 66: 192.100.0.31.41560 &gt; 10.16.203.160.sun-sr-https: Flags [F.], seq 78, ack 78, win 502, options [nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2923462901</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 535621017], length 0</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14:35:24.745843</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fe:ff:ff:ff:ff:ff</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">d0:00:37:51:21:65,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ethertype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IPv4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0800), length 66: 10.16.203.160.sun-sr-https &gt; 192.100.0.31.41560: Flags [.], ack 79, win 509, options [nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">535621017</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 2923462901], length 0</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14:35:29.810470</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> d0:00:37:51:21:65</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">fe:ff:ff:ff:ff:ff,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ethertype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ARP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0806), length 42: Request who-has 192.100.0.254 tell 192.100.0.31, length 28</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14:35:29.811266</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fe:ff:ff:ff:ff:ff</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">d0:00:37:51:21:65,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ethertype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ARP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0806), length 42: Request who-has 192.100.0.31 (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">d0:00:37:51:21:65</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) tell 192.100.0.254, length 28</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14:35:29.811287</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> d0:00:37:51:21:65</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">fe:ff:ff:ff:ff:ff,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ethertype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ARP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0806), length 42: Reply 192.100.0.31 is-at d0:00:37:51:21:65, length 28</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">14:35:29.812634</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fe:ff:ff:ff:ff:ff</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">d0:00:37:51:21:65,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ethertype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ARP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (0x0806), length 42: Reply 192.100.0.254 is-at fe:ff:ff:ff:ff:ff, length 28</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 解释一下这个抓包 （http的三次握手）</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 如果此时有输出但是没有数据响应</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>虚拟网卡if2090037512165对应走在哪个网桥呢</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-vsctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> show</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 从下面可以看到虚拟网卡(网络接口) 在br0网桥</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 并且这个网桥受控于 SDN 控制器也就是: Controller &quot;tcp:127.0.0.1:6632&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 最终结论是虚拟网卡 if2090037512165 对应的网卡是 eth-int </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 而 eth-int 的网卡对是最终走了物理网卡 enp1s0</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 所以需要对物理网卡 enp1s0 抓包</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 判定物理网卡 enp1s0 的流量有没有出去</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">b621d944-5691-4c9d-b01c-d8add7b7450f</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Bridge</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> br-ext</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;enp1s0&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;enp1s0&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> br-ext</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> br-ext</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> internal</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eth-ext</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eth-ext</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Bridge</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;br0&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Controller</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;tcp:127.0.0.1:6632&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            is_connected:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        fail_mode:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secure</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eth-int</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eth-int</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if2320004a0bceb&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if2320004a0bceb&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if09100a067b6cf&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if09100a067b6cf&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;br0&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;br0&quot;</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> internal</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if0300063b9a65f&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if0300063b9a65f&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        Port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if2090037512165&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            Interface</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;if2090037512165&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    ovs_version:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;2.12.0&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>网络无法连接时候，排查问题的思路就是理解数据的走向，然后对各个网卡进行抓包，如果抓到是物理网卡出现问题那么脱离软件层面</p></blockquote><ol start="7"><li>如何理解ebpf本质上在这次pod与kubernetes.svc.clusterIP通信时候做了什么事情</li></ol><p>kubernetes service clusterIP 转为 Endpoints 是吗</p>',25)]))}]]),t=JSON.parse('{"path":"/posts/cni/%E7%BD%91%E7%BB%9C%E4%B8%8D%E9%80%9A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5.html","title":"网络不通问题排查","lang":"zh-CN","frontmatter":{"title":"网络不通问题排查","tags":["docker"],"categories":["docker"],"description":"详细描述pod内无法访问apiserver cluster ip的时候的问题排查 一、问题描述 二、通信原理 在 pod nginx 之中curl service of kubernetes的 cluster IP，最终会指向 service 的 Endpoints ，也就是说本质上是 pod 与 Endpoints无法连通，继续追踪他们之间的数据流走...","gitInclude":[],"head":[["meta",{"property":"og:url","content":"https://weiqiangxu.github.io/posts/cni/%E7%BD%91%E7%BB%9C%E4%B8%8D%E9%80%9A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5.html"}],["meta",{"property":"og:site_name","content":"QuickStart程序员"}],["meta",{"property":"og:title","content":"网络不通问题排查"}],["meta",{"property":"og:description","content":"详细描述pod内无法访问apiserver cluster ip的时候的问题排查 一、问题描述 二、通信原理 在 pod nginx 之中curl service of kubernetes的 cluster IP，最终会指向 service 的 Endpoints ，也就是说本质上是 pod 与 Endpoints无法连通，继续追踪他们之间的数据流走..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:tag","content":"docker"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"网络不通问题排查\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"xuweiqiang\\",\\"url\\":\\"https://weiqiangxu.github.io\\"}]}"]]},"headers":[{"level":3,"title":"一、问题描述","slug":"一、问题描述","link":"#一、问题描述","children":[]},{"level":3,"title":"二、通信原理","slug":"二、通信原理","link":"#二、通信原理","children":[]},{"level":3,"title":"二、Q&A","slug":"二、q-a","link":"#二、q-a","children":[]}],"readingTime":{"minutes":6.88,"words":2065},"filePathRelative":"posts/cni/网络不通问题排查.md","excerpt":"<blockquote>\\n<p>详细描述pod内无法访问apiserver cluster ip的时候的问题排查</p>\\n</blockquote>\\n<h3>一、问题描述</h3>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" data-title=\\"bash\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 查看</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> kubectl</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> get</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> svc</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">NAME</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">           TYPE</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">        CLUSTER-IP</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">    EXTERNAL-IP</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">   PORT</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">(</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">S</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">)        </span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">AGE</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">kubernetes</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">     ClusterIP</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\">   10.96.0.1</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">     &lt;</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">non</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">e&gt;        </span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">443/TCP</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">        3d23h</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">loki-service</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">   NodePort</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\">    10.96.167.4</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">   &lt;</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">non</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">e&gt;        </span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">80:30009/TCP</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">   37h</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 查看service详细</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> kubectl</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> describe</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> svc</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> kubernetes</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">Name:</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">              kubernetes</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">Namespace:</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">         default</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">Labels:</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">            component=apiserver</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#E45649;--shiki-dark:#E06C75\\">                   provider</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#56B6C2\\">=</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">kubernetes</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">Annotations:</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">       &lt;</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">non</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">e&gt;</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">Selector:</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">          &lt;</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">non</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">e&gt;</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">Type:</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">              ClusterIP</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">IP</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> Family</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> Policy:</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  SingleStack</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">IP</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> Families:</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">       IPv4</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">IP:</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\">                10.96.0.1</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">IPs:</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\">               10.96.0.1</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">Port:</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">              https</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  443/TCP</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">TargetPort:</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">        6443/TCP</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">Endpoints:</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">         10.16.203.160:6443</span><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"> # 端点，表示这个Service对应的backend后台pod服务端点</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">Session</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> Affinity:</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">  None</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">Events:</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">            &lt;</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\">non</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">e&gt;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 进入pod无法访问</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> kubectl</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> exec</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -it</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> test-nginx-deployment-ff8c6f675-fjq4l</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -n</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> sdn-1</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> --</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> /bin/sh</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> curl</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> 10.96.0.1:443</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 没有任何输出表示无法连接</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 这一行是正常情况会输出的，但是没有输出 `Client sent an HTTP request to an HTTPS server.`</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}')}}]);