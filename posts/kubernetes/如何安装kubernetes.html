<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.17" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.58" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://weiqiangxu.github.io/posts/kubernetes/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85kubernetes.html"><meta property="og:site_name" content="QuickStart程序员"><meta property="og:title" content="如何安装kubernetes"><meta property="og:description" content="使用kubeadm搭建kubenertes环境 一、环境准备 CentOS 7.6 64bit 2核 2G * 2 ( 操作系统的版本至少在7.5以上 ) 1.环境准备之 kubernetes v1.26 CRI 2.使用部署工具kubeadm安装 kubernetes v1.26 1.防火墙 2.设置主机名 3.主机域名解析 4.统一时间 5.关闭s..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="kubernetes"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"如何安装kubernetes","image":[""],"dateModified":null,"author":[{"@type":"Person","name":"xuweiqiang","url":"https://weiqiangxu.github.io"}]}</script><title>如何安装kubernetes | QuickStart程序员</title><meta name="description" content="使用kubeadm搭建kubenertes环境 一、环境准备 CentOS 7.6 64bit 2核 2G * 2 ( 操作系统的版本至少在7.5以上 ) 1.环境准备之 kubernetes v1.26 CRI 2.使用部署工具kubeadm安装 kubernetes v1.26 1.防火墙 2.设置主机名 3.主机域名解析 4.统一时间 5.关闭s...">
    <link rel="stylesheet" href="/assets/css/styles.e88d9fe7.css">
    <link rel="preload" href="/assets/js/runtime~app.a217d4a6.js" as="script"><link rel="preload" href="/assets/css/styles.e88d9fe7.css" as="style"><link rel="preload" href="/assets/js/4596.7214a8f8.js" as="script"><link rel="preload" href="/assets/js/app.996ba4c1.js" as="script">
    <link rel="prefetch" href="/assets/js/posts_kubernetes_如何安装kubernetes.html.e7ceadb1.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_腾讯代码规范.html.308f2f73.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_node_exporter指标解析.html.84d4a2c3.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_springboot的mongodb指标.html.60746b80.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_什么是CNI.html.8472ffb8.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_mongodb指标采集.html.8835b09d.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_kubernetes基础问题.html.93400ca9.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_kubectl_command.html.3e2817aa.js" as="script"><link rel="prefetch" href="/assets/js/posts_java_制作maven包.html.870fdbb3.js" as="script"><link rel="prefetch" href="/assets/js/posts_loki_基于loki搭建k8s审计日志.html.03b22ec8.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_alertmanager高可用机制.html.68ed0e64.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_网络基础.html.3ef99931.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_NAT配置公网访问.html.3b363245.js" as="script"><link rel="prefetch" href="/assets/js/posts_kafka_kafka基础入门.html.33a1d3ae.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_什么是网桥.html.0b63b66d.js" as="script"><link rel="prefetch" href="/assets/js/8300.24745011.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_flanne接入k8s.html.3626532f.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_mybatis监控指标.html.0eb3bc5b.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_搭建alertmanager告警服务.html.9256e573.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_CI制作多架构镜像.html.4ef069a8.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_alertmanager的历史告警.html.68989614.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_个人编码规范.html.ac4e5397.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_安全容器.html.c78a7780.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_如何构建vxlan网络.html.28fc118b.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_golang生产者消费者模式.html.2761f28d.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_k8s集群管理相关文件.html.e179c642.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_磁盘扩容.html.8b93f312.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_什么是网络命名空间.html.a695b7f5.js" as="script"><link rel="prefetch" href="/assets/js/posts_loki_docker安装loki采集日志.html.c470679a.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_用CNI给docker容器分配网络.html.61eb109e.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_prometheus高可用方案预研.html.83371325.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_使用tun设备实现VPN通信.html.a8027b12.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_网卡.html.3ee2b803.js" as="script"><link rel="prefetch" href="/assets/js/posts_etcd_Etcd开启SSL认证.html.775f0317.js" as="script"><link rel="prefetch" href="/assets/js/posts_gitlab_runner在Docker安装.html.7aafc048.js" as="script"><link rel="prefetch" href="/assets/js/posts_docker_集成kata.html.4a835446.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_containerd和kata_firecracker环境搭建.html.40e91f92.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_write_broken_pipe.html.a2ca98bf.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_snapshot备份数据.html.c16f8ffb.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_如何优雅的依据结构体拼接URL.html.b6639697.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_veth-pair和ovs-bridge通讯.html.77dcd6e3.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_常用命令.html.b4e098b3.js" as="script"><link rel="prefetch" href="/assets/js/posts_docker_双网卡实现网络隔离.html.7126dea3.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_制作helm包和自建Chart仓库.html.889127ac.js" as="script"><link rel="prefetch" href="/assets/js/posts_docker_制作多架构镜像.html.27ca7e46.js" as="script"><link rel="prefetch" href="/assets/js/posts_docker_镜像仓库搭建.html.aa19f30c.js" as="script"><link rel="prefetch" href="/assets/js/posts_loki_在k8s创建loki服务采集日志.html.fd7a662c.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_ipip隧道通讯.html.7ab876f5.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_磁盘分区.html.cff7f384.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_linux上如何配置静态路由.html.ab8f2f02.js" as="script"><link rel="prefetch" href="/assets/js/posts_docker_分配网络给容器.html.1ea3409c.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_网络.html.ef37876c.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_基于docker搭建联邦机制主从同步.html.8f6162f9.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_代码分层实践.html.929703ef.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_kubernetes审计日志.html.3d345a30.js" as="script"><link rel="prefetch" href="/assets/js/posts_nginx_会话粘性.html.22cf59e0.js" as="script"><link rel="prefetch" href="/assets/js/posts_docker_多架构镜像存储.html.280ed037.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_containerd安装.html.5a5b0945.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_kubernetes容器安全.html.d2cd3475.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_如何使用GRE隧道通信.html.00f2452a.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_创建informer.html.d764285f.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_lsof命令.html.0d256cee.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_Nginx-Ingress安装.html.71f7679a.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_初识CRD.html.4a997736.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_prometheus的资源占用分析.html.9a211fc7.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_如何优雅地使用errors.html.f4bd6d6d.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_eBPF工具库.html.70650eb6.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_基础入门.html.35b56234.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_简单的webhook.html.7fcb93a4.js" as="script"><link rel="prefetch" href="/assets/js/posts_nginx_开启SSL验证.html.b14bf89c.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_制作镜像编译kata.html.19da2451.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_CRD控制器.html.76613791.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_tcp连接与抓包.html.74714872.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_iperf用法.html.baa978f5.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_module冲突.html.6c716f61.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_veth-pair和host网桥通信.html.d72bbf35.js" as="script"><link rel="prefetch" href="/assets/js/posts_registry_chartmuseum.html.a459950d.js" as="script"><link rel="prefetch" href="/assets/js/posts_docker_docker离线安装.html.764d0b45.js" as="script"><link rel="prefetch" href="/assets/js/posts_mongodb_Mongo集群.html.b2a68ded.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_二进制.html.12269ae6.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_traefik配置ingress服务.html.5174e899.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_eBPF_cilium快速入门.html.daeefa6f.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_golang导出docker镜像.html.9b556b81.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_分片RedisCluster原理.html.7eda3515.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_优化params是any接口.html.743e7364.js" as="script"><link rel="prefetch" href="/assets/js/posts_architecture_解构领域驱动设计.html.ff11b077.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Redis集群模式Docker搭建.html.2b2c8ab6.js" as="script"><link rel="prefetch" href="/assets/js/posts_makefile_awk使用.html.ef1d6e41.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_如何配置go私有库.html.4a19548b.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_GRPC底层调优.html.c579e6b0.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_创建service指向外部服务.html.08bb6449.js" as="script"><link rel="prefetch" href="/assets/js/posts_architecture_CAP.html.c05dbb40.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_GC.html.eed8729e.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_k8s的一些插件安装.html.8f50c938.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_数据结构理解数据类型.html.61d8d4da.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_高可用-主从复制详解.html.fca4ee54.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_基于远程写同步数据prometheus集群.html.92ad4077.js" as="script"><link rel="prefetch" href="/assets/js/posts_gitlab_Linux如何安装使用.html.cf4c62f0.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_Socket是什么.html.764c3d98.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_干货满满GoModules.html.29c3290a.js" as="script"><link rel="prefetch" href="/assets/js/posts_java_docker安装maven仓库.html.d6eb6988.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_DNS服务配置有哪些.html.29d9aa50.js" as="script"><link rel="prefetch" href="/assets/js/posts_makefile_基本使用.html.d6218550.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_如何命令行执行单元测试.html.2f044c35.js" as="script"><link rel="prefetch" href="/assets/js/posts_gitlab_git密钥相关配置.html.eaf6ea13.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_linux服务器ssh密钥.html.3f6735d0.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_什么是DHCP.html.abbe9b2f.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_分片RedisCluster搭建.html.aa4f38a8.js" as="script"><link rel="prefetch" href="/assets/js/posts_nginx_域名指向配置.html.23c9ce54.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_prometheus配置解析.html.afebd4f4.js" as="script"><link rel="prefetch" href="/assets/js/posts_docker_集成gvisor.html.f2ecd0f1.js" as="script"><link rel="prefetch" href="/assets/js/posts_kafka_group.html.19768a0f.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_cpu架构.html.5b76b647.js" as="script"><link rel="prefetch" href="/assets/js/posts_kafka_同步发送和异步发送.html.ac81abcd.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_pod日志.html.ab513b19.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_如何添加node节点.html.d077d3b9.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_GMP原理与调度.html.f5e99835.js" as="script"><link rel="prefetch" href="/assets/js/posts_kafka_同步提交和异步提交.html.1cb3ffb7.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_过期删除和内存淘汰.html.661276c6.js" as="script"><link rel="prefetch" href="/assets/js/posts_docker_buildx.html.1e11e112.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Redis缓存一致性.html.f86b8155.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Redis集群分布式锁.html.1dc20878.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_分片技术.html.d65f4c84.js" as="script"><link rel="prefetch" href="/assets/js/posts_gitlab_gitlab-ci如何编写.html.7ff2f628.js" as="script"><link rel="prefetch" href="/assets/js/posts_architecture_CDN技术.html.a7ea119a.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_调试工具telepresence.html.ef5bf1d5.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_哨兵模式.html.a132ddb8.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_环境变量配置.html.112d93e2.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_什么是邻居表.html.bb456d77.js" as="script"><link rel="prefetch" href="/assets/js/posts_mysql_MySQL集群.html.8efbac5c.js" as="script"><link rel="prefetch" href="/assets/js/posts_registry_registry.html.10d8bf4c.js" as="script"><link rel="prefetch" href="/assets/js/posts_architecture_分布式事务概念.html.a4d10b2c.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_持久化AOF日志.html.75a6c9b6.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_golang静态扫描和格式检查.html.2a1c23f9.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Redis事务.html.1b05302c.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_golang交叉编译.html.200979ae.js" as="script"><link rel="prefetch" href="/assets/js/posts_kafka_Rebalance机制.html.7733ae83.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_rpm.html.056a8240.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_harbor安装和使用.html.c5fd8e69.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Redis限频.html.2673585d.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_字符串拼接性能及原理.html.8a4b542c.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_k8s上搭建MySQL主从集群.html.74a1388d.js" as="script"><link rel="prefetch" href="/assets/js/posts_docker_dind.html.5bf3ea12.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_监听信号.html.55e5c986.js" as="script"><link rel="prefetch" href="/assets/js/posts_makefile_docker.html.5d6c28fd.js" as="script"><link rel="prefetch" href="/assets/js/posts_etcd_Raft算法实现.html.4a441f3d.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_Channel.html.9aa11cd9.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_map底层数据结构.html.9f7eaee1.js" as="script"><link rel="prefetch" href="/assets/js/posts_kafka_如何不重复消费又不丢失数据.html.f0499a9f.js" as="script"><link rel="prefetch" href="/assets/js/posts_docker_私服配置.html.b8cce5b9.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_middleware底层实现原理.html.f72b3c2c.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_golang引用传递和值传递.html.4d9a66b7.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_ApiGetway设计.html.1f11b49e.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_面试题.html.df94d954.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_查看prometheus占用内存.html.16a60005.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_Context源码解析.html.76060ea0.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Redis集群模式之主从模式.html.ef0ff7d0.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_微服务与DDD.html.d3fd6c00.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_使用range必懂的点.html.e41d25ca.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_持久化RDB快照.html.7e1d4f64.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_Mutex.html.59506760.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_本地启动prometheus服务.html.4272f5aa.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_k8s的资源管理.html.9ce6d8f0.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_如何退出协程.html.03cc6b83.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_GMP-hello的执行过程.html.f30ab567.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_Linux结构组成.html.9161a44e.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_堆和栈的区别.html.2303bc46.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_uname.html.167dcc10.js" as="script"><link rel="prefetch" href="/assets/js/posts_java_Java版本.html.cdabf0a1.js" as="script"><link rel="prefetch" href="/assets/js/posts_gitlab_runner镜像制作.html.9e9dd442.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_golang实现简单的指标exporter.html.5a97d2cd.js" as="script"><link rel="prefetch" href="/assets/js/posts_loki_loki.html.18f78d06.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_tcp粘包.html.0602bbc6.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_什么是openTracing.html.497e8cff.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_mongodb自定义排序.html.9faa79f0.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Redis缓存雪崩击穿和穿透.html.bc7d29fd.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_golang的内存管理.html.9bd9f325.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Redis集群模式之哨兵模式.html.66faf137.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_8.GoModules.html.5cdf6ea3.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_请求转发.html.8be2aa9d.js" as="script"><link rel="prefetch" href="/assets/js/posts_kafka_分区和副本机制.html.57709b1e.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Redis主从脑裂问题和解决方案.html.2f1c8f7d.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_Chart.html.35f2d046.js" as="script"><link rel="prefetch" href="/assets/js/posts_gitlab_index.html.ff936e78.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Redis集群模式之分片Cluster模式.html.7f9e73a5.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_网络常用的命令.html.cf87ec09.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_kubectl.html.7499911b.js" as="script"><link rel="prefetch" href="/assets/js/posts_mysql_MVCC实现机制.html.717736c3.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_2.GPM设计思想.html.45cf0ae1.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_Kubernetes组件.html.095c0092.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_reflect的性能.html.86152561.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_float浮点数精度.html.7deeb3a6.js" as="script"><link rel="prefetch" href="/assets/js/posts_elastic_10道不得不会的面试题.html.1bb28743.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_kubeadm.html.81c05974.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Blogs.html.5b95212f.js" as="script"><link rel="prefetch" href="/assets/js/posts_mysql_MySQL规范.html.92ce1e9e.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_for和range性能比较.html.390acc23.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_抢占式调度.html.a1c8c4d5.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_如何池化连接.html.a60c5035.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_map.html.db1ef276.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_kubernetes架构设计.html.3362bca3.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_架构搭建流程.html.229ca533.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_发行版和包管理工具.html.cc3e22e9.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_bitmap位图.html.e61b0937.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_GMP-让出恢复创建过程.html.c3f0ac3b.js" as="script"><link rel="prefetch" href="/assets/js/posts_kafka_kafka基础.html.b693611c.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Redis的数据备份和恢复.html.282f02db.js" as="script"><link rel="prefetch" href="/assets/js/posts_mysql_性能优化.html.2c501269.js" as="script"><link rel="prefetch" href="/assets/js/posts_kafka_参数详解.html.bb7955dc.js" as="script"><link rel="prefetch" href="/assets/js/posts_nacos_docker安装nacos.html.30b7749f.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_GMP-协程让出抢占调度监控.html.2751bfbe.js" as="script"><link rel="prefetch" href="/assets/js/posts_consul_index.html.9980bebf.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_信号量.html.9502fbdf.js" as="script"><link rel="prefetch" href="/assets/js/posts_etcd_Docker安装Etcd.html.e16ddd6c.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_cluster.html.b62fada8.js" as="script"><link rel="prefetch" href="/assets/js/posts_kafka_index.html.41459c0d.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_揭秘Build约束.html.e52cec94.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Redis常见应用.html.0e99ceb7.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_goland快捷键.html.19fcb780.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_内存碎片.html.bd2bc523.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_S3对象存储.html.1c953f88.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_分布式链路追踪.html.542284da.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_Security规范.html.1c484352.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_原子操作.html.2a98832a.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_UnitTest规范.html.823bf50c.js" as="script"><link rel="prefetch" href="/assets/js/posts_makefile_index.html.85086676.js" as="script"><link rel="prefetch" href="/assets/js/intro.html.5ed355d5.js" as="script"><link rel="prefetch" href="/assets/js/posts_gitlab_构建应用.html.076f37db.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_tcp连接可以一直保持吗.html.27772a26.js" as="script"><link rel="prefetch" href="/assets/js/posts_mysql_MySQL分层.html.3e7b636f.js" as="script"><link rel="prefetch" href="/assets/js/posts_architecture_如何快速提高架构设计能力.html.26c7bee2.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_7.defer知识点.html.a0a6b601.js" as="script"><link rel="prefetch" href="/assets/js/posts_mysql_SQL执行过程详解.html.71197139.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_构建VPN通讯.html.da01095d.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_kube-proxy设计与实现.html.a6910f18.js" as="script"><link rel="prefetch" href="/assets/js/posts_etcd_如何实现分布式锁.html.8bcec7d2.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_index.html.22523b32.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_调试工具.html.e82a0a3c.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Hash.html.ca7c7f11.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_websocket.html.696faf9b.js" as="script"><link rel="prefetch" href="/assets/js/posts_etcd_实现服务注册和发现.html.a1bf2ae1.js" as="script"><link rel="prefetch" href="/assets/js/posts_architecture_康威定律.html.d89fd3af.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_plan.html.b67ef7a3.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_如何发布包到pkg.html.7440227a.js" as="script"><link rel="prefetch" href="/assets/js/posts_elastic_Elastic集群.html.cc891f3a.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_index.html.8a72235a.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_图解泛洪与广播风暴.html.21bcc498.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_内存对齐.html.f849f868.js" as="script"><link rel="prefetch" href="/assets/js/posts_infoq_后台开发关心的kubernetes网络问题.html.da98ac17.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_runtime包.html.37d16668.js" as="script"><link rel="prefetch" href="/assets/js/posts_gitlab_如何编写流水线fmt__lint.html.e089dfd4.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_kubernetes的ingress-nginx配置会话粘性.html.8e0e936b.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_List.html.d4f332f9.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Key.html.72fb1073.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_cherry.html.801693e4.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_dragonfruit.html.f202be57.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_条件编译.html.5c67d3cf.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_kubernetes离线部署.html.9dec012c.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_GPM原理和调度.html.dd6ec5d1.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_如何判定零值.html.d711b871.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Set.html.391533dc.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_什么是stream.html.1c7b0eaf.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Redis发布订阅.html.b1a0c1c2.js" as="script"><link rel="prefetch" href="/assets/js/posts_nacos_index.html.ff067ea4.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_containerd中集成kata.html.d53d9947.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_string.html.b8c46118.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_slice底层数据结构.html.7a8b0633.js" as="script"><link rel="prefetch" href="/assets/js/posts_cicd_index.html.d0be6b96.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_defer实现原理.html.57602869.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_endpoints.html.cffced66.js" as="script"><link rel="prefetch" href="/assets/js/posts_makefile_专业术语.html.bfa4e6e2.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_string底层数据结构.html.345ecb1f.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_struct底层数据结构.html.a5348e20.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_互斥锁实现原理.html.32f6af93.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_map实现原理.html.1229aa9b.js" as="script"><link rel="prefetch" href="/assets/js/posts_infoq_单元测试的艺术.html.469798b1.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_sync.Map实现原理.html.b60c1e57.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_chan底层数据结构.html.dd63d1e8.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_读写锁实现原理.html.2965361b.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_String.html.b49f844a.js" as="script"><link rel="prefetch" href="/assets/js/posts_elastic_index.html.d208ccf9.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_gin-pprof.html.0162736e.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_函数调用栈.html.3558af58.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_index.html.e207bfd3.js" as="script"><link rel="prefetch" href="/assets/js/posts_architecture_index.html.f661d70a.js" as="script"><link rel="prefetch" href="/assets/js/posts_redis_Redis集群模式之分布式事务.html.87cc70c3.js" as="script"><link rel="prefetch" href="/assets/js/posts_restfulapi_restfulAPI.html.aedf6fa2.js" as="script"><link rel="prefetch" href="/assets/js/posts_gitlab_搭建docker hub私服.html.485612dc.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_kubeadm命令学习.html.b0119f79.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_log源码.html.1e43df54.js" as="script"><link rel="prefetch" href="/assets/js/posts_mongodb_mongo_single.html.cd9e747e.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_pprof基本使用.html.4dc37a61.js" as="script"><link rel="prefetch" href="/assets/js/posts_kubernetes_systemctl.html.69e3897b.js" as="script"><link rel="prefetch" href="/assets/js/posts_go_什么是unary.html.cf115650.js" as="script"><link rel="prefetch" href="/assets/js/posts_nacos_nacos.html.596d1241.js" as="script"><link rel="prefetch" href="/assets/js/tag_领域驱动模型设计_index.html.28175653.js" as="script"><link rel="prefetch" href="/assets/js/category_领域驱动设计_index.html.49b72a6b.js" as="script"><link rel="prefetch" href="/assets/js/tag_分布式事务_index.html.689a283d.js" as="script"><link rel="prefetch" href="/assets/js/posts_index.html.ff75bf5a.js" as="script"><link rel="prefetch" href="/assets/js/tag_内存分析_index.html.c7957e99.js" as="script"><link rel="prefetch" href="/assets/js/tag_单元测试_index.html.dd24ce22.js" as="script"><link rel="prefetch" href="/assets/js/tag_架构设计_index.html.4bbf50f2.js" as="script"><link rel="prefetch" href="/assets/js/category_分布式_index.html.56db101e.js" as="script"><link rel="prefetch" href="/assets/js/category_火龙果_index.html.388176f7.js" as="script"><link rel="prefetch" href="/assets/js/tag_kafka原理_index.html.340c4b91.js" as="script"><link rel="prefetch" href="/assets/js/tag_高可用_index.html.8be18200.js" as="script"><link rel="prefetch" href="/assets/js/tag_golangci-lint_index.html.08de7933.js" as="script"><link rel="prefetch" href="/assets/js/tag_alertmanager_index.html.1afd6c2c.js" as="script"><link rel="prefetch" href="/assets/js/tag_telepresence_index.html.9913d3a9.js" as="script"><link rel="prefetch" href="/assets/js/category_kubernetes_index.html.c86a6c99.js" as="script"><link rel="prefetch" href="/assets/js/category_restfulapi_index.html.51e316a8.js" as="script"><link rel="prefetch" href="/assets/js/category_prometheus_index.html.be8f7385.js" as="script"><link rel="prefetch" href="/assets/js/tag_go原理_index.html.f1a7030a.js" as="script"><link rel="prefetch" href="/assets/js/category_樱桃_index.html.8715aab6.js" as="script"><link rel="prefetch" href="/assets/js/category_水果_index.html.df22bb6c.js" as="script"><link rel="prefetch" href="/assets/js/tag_chartmuseum_index.html.403f9644.js" as="script"><link rel="prefetch" href="/assets/js/tag_dockerfile_index.html.320b113d.js" as="script"><link rel="prefetch" href="/assets/js/tag_kubernetes_index.html.277ed65a.js" as="script"><link rel="prefetch" href="/assets/js/tag_restfulapi_index.html.b9bacb5a.js" as="script"><link rel="prefetch" href="/assets/js/tag_springboot_index.html.3a8d7d11.js" as="script"><link rel="prefetch" href="/assets/js/tag_containerd_index.html.4548f6a2.js" as="script"><link rel="prefetch" href="/assets/js/tag_prometheus_index.html.0f9b564e.js" as="script"><link rel="prefetch" href="/assets/js/tag_告警_index.html.3635f9c1.js" as="script"><link rel="prefetch" href="/assets/js/tag_监控_index.html.0a28d73e.js" as="script"><link rel="prefetch" href="/assets/js/category_network_index.html.2f850318.js" as="script"><link rel="prefetch" href="/assets/js/tag_registry_index.html.44c1ba4b.js" as="script"><link rel="prefetch" href="/assets/js/tag_promtail_index.html.e5306e35.js" as="script"><link rel="prefetch" href="/assets/js/category_docker_index.html.123a0a95.js" as="script"><link rel="prefetch" href="/assets/js/category_golang_index.html.6facead0.js" as="script"><link rel="prefetch" href="/assets/js/tag_mongodb_index.html.107a5a07.js" as="script"><link rel="prefetch" href="/assets/js/tag_mybatis_index.html.9fe23ddd.js" as="script"><link rel="prefetch" href="/assets/js/tag_kubectl_index.html.8e556099.js" as="script"><link rel="prefetch" href="/assets/js/tag_network_index.html.73ea223e.js" as="script"><link rel="prefetch" href="/assets/js/category_kafka_index.html.af5fd9e8.js" as="script"><link rel="prefetch" href="/assets/js/category_nginx_index.html.e9c11764.js" as="script"><link rel="prefetch" href="/assets/js/index.html.5a573452.js" as="script"><link rel="prefetch" href="/assets/js/category_linux_index.html.5771d275.js" as="script"><link rel="prefetch" href="/assets/js/tag_docker_index.html.0117b745.js" as="script"><link rel="prefetch" href="/assets/js/tag_golang_index.html.726a230a.js" as="script"><link rel="prefetch" href="/assets/js/category_etcd_index.html.bf31db9c.js" as="script"><link rel="prefetch" href="/assets/js/category_java_index.html.d04750fc.js" as="script"><link rel="prefetch" href="/assets/js/tag_audit_index.html.51e0e249.js" as="script"><link rel="prefetch" href="/assets/js/tag_kafka_index.html.be14c6f8.js" as="script"><link rel="prefetch" href="/assets/js/tag_linux_index.html.b0b6ce1b.js" as="script"><link rel="prefetch" href="/assets/js/tag_nginx_index.html.cc962d1c.js" as="script"><link rel="prefetch" href="/assets/js/tag_大_index.html.c091c799.js" as="script"><link rel="prefetch" href="/assets/js/tag_小_index.html.a7d9550c.js" as="script"><link rel="prefetch" href="/assets/js/tag_红_index.html.1d9339a1.js" as="script"><link rel="prefetch" href="/assets/js/404.html.f8338094.js" as="script"><link rel="prefetch" href="/assets/js/category_git_index.html.fe9ef17b.js" as="script"><link rel="prefetch" href="/assets/js/category_gmp_index.html.c0da630a.js" as="script"><link rel="prefetch" href="/assets/js/tag_圆_index.html.e8d37db3.js" as="script"><link rel="prefetch" href="/assets/js/tag_cicd_index.html.44daca9d.js" as="script"><link rel="prefetch" href="/assets/js/tag_etcd_index.html.19278154.js" as="script"><link rel="prefetch" href="/assets/js/tag_kata_index.html.0cc38f6e.js" as="script"><link rel="prefetch" href="/assets/js/tag_loki_index.html.78bddf65.js" as="script"><link rel="prefetch" href="/assets/js/tag_helm_index.html.08410b66.js" as="script"><link rel="prefetch" href="/assets/js/tag_java_index.html.8d5447ff.js" as="script"><link rel="prefetch" href="/assets/js/tag_runc_index.html.5775320d.js" as="script"><link rel="prefetch" href="/assets/js/category_go_index.html.90f49292.js" as="script"><link rel="prefetch" href="/assets/js/tag_api_index.html.1ee43dd7.js" as="script"><link rel="prefetch" href="/assets/js/tag_cdn_index.html.2b633fca.js" as="script"><link rel="prefetch" href="/assets/js/tag_fmt_index.html.f777f02d.js" as="script"><link rel="prefetch" href="/assets/js/tag_git_index.html.099138af.js" as="script"><link rel="prefetch" href="/assets/js/tag_gmp_index.html.3706451c.js" as="script"><link rel="prefetch" href="/assets/js/tag_net_index.html.66979c18.js" as="script"><link rel="prefetch" href="/assets/js/tag_cap_index.html.285ded18.js" as="script"><link rel="prefetch" href="/assets/js/tag_gin_index.html.7c847f12.js" as="script"><link rel="prefetch" href="/assets/js/tag_go_index.html.eb9c8994.js" as="script"><link rel="prefetch" href="/assets/js/timeline_index.html.5ab1199f.js" as="script"><link rel="prefetch" href="/assets/js/category_index.html.cd8b0323.js" as="script"><link rel="prefetch" href="/assets/js/posts_prometheus_index.html.8581d7dc.js" as="script"><link rel="prefetch" href="/assets/js/posts_restfulapi_index.html.de8b03fb.js" as="script"><link rel="prefetch" href="/assets/js/article_index.html.005b2f46.js" as="script"><link rel="prefetch" href="/assets/js/tag_index.html.037b4b29.js" as="script"><link rel="prefetch" href="/assets/js/posts_registry_index.html.206eefde.js" as="script"><link rel="prefetch" href="/assets/js/star_index.html.c0a49d11.js" as="script"><link rel="prefetch" href="/assets/js/posts_mongodb_index.html.ada0634a.js" as="script"><link rel="prefetch" href="/assets/js/posts_network_index.html.d25c7e50.js" as="script"><link rel="prefetch" href="/assets/js/posts_docker_index.html.135280d3.js" as="script"><link rel="prefetch" href="/assets/js/posts_linux_index.html.69fdd74e.js" as="script"><link rel="prefetch" href="/assets/js/posts_mysql_index.html.1bf44279.js" as="script"><link rel="prefetch" href="/assets/js/posts_nginx_index.html.89371c7c.js" as="script"><link rel="prefetch" href="/assets/js/posts_infoq_index.html.70d88f50.js" as="script"><link rel="prefetch" href="/assets/js/posts_etcd_index.html.30fc4c61.js" as="script"><link rel="prefetch" href="/assets/js/posts_java_index.html.844ae48a.js" as="script"><link rel="prefetch" href="/assets/js/posts_loki_index.html.ce22bde7.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/" aria-label="带我回家"><img class="vp-nav-logo" src="https://theme-hope-assets.vuejs.press/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">QuickStart程序员</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="主页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="程序人生"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><!--]-->程序人生<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/weiqiangxu/docs" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/" aria-label="主页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->主页<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/posts/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html" aria-label="Linux"><!---->Linux<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Golang</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Docker</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">网络</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">prometheus</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Etcd</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Nginx</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Kubernetes</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/" aria-label="官方手册"><!---->官方手册<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/%E5%AE%89%E5%85%A8%E5%AE%B9%E5%99%A8.html" aria-label="安全容器"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-object-group" style=""></span><!--]-->安全容器<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/%E5%88%9D%E8%AF%86CRD.html" aria-label="初识CRD"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-object-group" style=""></span><!--]-->初识CRD<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/%E5%88%9B%E5%BB%BAservice%E6%8C%87%E5%90%91%E5%A4%96%E9%83%A8%E6%9C%8D%E5%8A%A1.html" aria-label="创建service和endpoints指向外部服务"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-object-group" style=""></span><!--]-->创建service和endpoints指向外部服务<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/posts/kubernetes/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85kubernetes.html" aria-label="如何安装kubernetes"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-object-group" style=""></span><!--]-->如何安装kubernetes<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/Kubernetes%E7%BB%84%E4%BB%B6.html" aria-label="Kubernetes组件"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-object-group" style=""></span><!--]-->Kubernetes组件<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/%E5%88%9B%E5%BB%BAinformer.html" aria-label="/posts/kubernetes/%E5%88%9B%E5%BB%BAinformer.html"><!---->/posts/kubernetes/%E5%88%9B%E5%BB%BAinformer.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/k8s%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6.html" aria-label="/posts/kubernetes/k8s%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6.html"><!---->/posts/kubernetes/k8s%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/k8s%E4%B8%8A%E6%90%AD%E5%BB%BAMySQL%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4.html" aria-label="/posts/kubernetes/k8s%E4%B8%8A%E6%90%AD%E5%BB%BAMySQL%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4.html"><!---->/posts/kubernetes/k8s%E4%B8%8A%E6%90%AD%E5%BB%BAMySQL%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7telepresence.html" aria-label="调试工具telepresence"><!---->调试工具telepresence<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/pod%E6%97%A5%E5%BF%97.html" aria-label="集群级日志"><!---->集群级日志<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/traefik%E9%85%8D%E7%BD%AEingress%E6%9C%8D%E5%8A%A1.html" aria-label="配置traefik的ingress服务"><!---->配置traefik的ingress服务<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/kubernetes%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2.html" aria-label="如何离线安装kubernetes"><!---->如何离线安装kubernetes<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/linux%E4%B8%8A%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1.html" aria-label="如何配置静态路由"><!---->如何配置静态路由<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0node%E8%8A%82%E7%82%B9.html" aria-label="如何添加node节点"><!---->如何添加node节点<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/%E7%BD%91%E7%BB%9C%E5%B8%B8%E7%94%A8%E7%9A%84%E5%91%BD%E4%BB%A4.html" aria-label="网络常用命令"><!---->网络常用命令<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/%E7%94%A8CNI%E7%BB%99docker%E5%AE%B9%E5%99%A8%E5%88%86%E9%85%8D%E7%BD%91%E7%BB%9C.html" aria-label="用CNI给docker容器分配网络"><!---->用CNI给docker容器分配网络<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F%E7%BC%96%E8%AF%91kata.html" aria-label="制作镜像编译kata"><!---->制作镜像编译kata<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/%E5%88%B6%E4%BD%9Chelm%E5%8C%85%E5%92%8C%E8%87%AA%E5%BB%BAChart%E4%BB%93%E5%BA%93.html" aria-label="制作helm包和自建Chart仓库"><!---->制作helm包和自建Chart仓库<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/Chart.html" aria-label="chart"><!---->chart<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/CI%E5%88%B6%E4%BD%9C%E5%A4%9A%E6%9E%B6%E6%9E%84%E9%95%9C%E5%83%8F.html" aria-label="CI制作多架构镜像"><!---->CI制作多架构镜像<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/containerd%E5%AE%89%E8%A3%85.html" aria-label="containerd安装"><!---->containerd安装<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/containerd%E5%92%8Ckata_firecracker%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" aria-label="containerd和kata&amp;firecracker环境搭建"><!---->containerd和kata&amp;firecracker环境搭建<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/containerd%E4%B8%AD%E9%9B%86%E6%88%90kata.html" aria-label="containerd之中集成kata"><!---->containerd之中集成kata<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/CRD%E6%8E%A7%E5%88%B6%E5%99%A8.html" aria-label="CRD控制器"><!---->CRD控制器<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/eBPF_cilium%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html" aria-label="eBPF&amp;cilium快速入门"><!---->eBPF&amp;cilium快速入门<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/eBPF%E5%B7%A5%E5%85%B7%E5%BA%93.html" aria-label="eBPF工具库"><!---->eBPF工具库<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/endpoints.html" aria-label="endpoints"><!---->endpoints<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/flanne%E6%8E%A5%E5%85%A5k8s.html" aria-label="flannel接入k8s"><!---->flannel接入k8s<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/harbor%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8.html" aria-label="harbor install &amp;&amp; usage"><!---->harbor install &amp;&amp; usage<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/iperf%E7%94%A8%E6%B3%95.html" aria-label="iperf用法"><!---->iperf用法<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/k8s%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85.html" aria-label="k8s的一些插件安装"><!---->k8s的一些插件安装<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/k8s%E7%9A%84%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86.html" aria-label="k8s的资源管理"><!---->k8s的资源管理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/kube-proxy%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0.html" aria-label="kube-proxy设计与实现"><!---->kube-proxy设计与实现<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/kubeadm.html" aria-label="kubeadm"><!---->kubeadm<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/kubeadm%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0.html" aria-label="kubeadm 命令"><!---->kubeadm 命令<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/kubectl.html" aria-label="kubectl"><!---->kubectl<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/kubectl_command.html" aria-label="kubectl一些常用的命令"><!---->kubectl一些常用的命令<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/kubernetes%E7%9A%84ingress-nginx%E9%85%8D%E7%BD%AE%E4%BC%9A%E8%AF%9D%E7%B2%98%E6%80%A7.html" aria-label="kubernetes的ingress-nginx配置会话粘性"><!---->kubernetes的ingress-nginx配置会话粘性<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/kubernetes%E5%9F%BA%E7%A1%80%E9%97%AE%E9%A2%98.html" aria-label="kubernetes基础问题"><!---->kubernetes基础问题<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/kubernetes%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html" aria-label="kubernetes架构设计"><!---->kubernetes架构设计<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/kubernetes%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8.html" aria-label="kubernetes容器安全"><!---->kubernetes容器安全<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/kubernetes%E5%AE%A1%E8%AE%A1%E6%97%A5%E5%BF%97.html" aria-label="kubernetes审计日志"><!---->kubernetes审计日志<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/Nginx-Ingress%E5%AE%89%E8%A3%85.html" aria-label="Nginx-Ingress安装"><!---->Nginx-Ingress安装<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/S3%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8.html" aria-label="S3对象存储"><!---->S3对象存储<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/systemctl.html" aria-label="systemctl"><!---->systemctl<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/veth-pair%E5%92%8Chost%E7%BD%91%E6%A1%A5%E9%80%9A%E4%BF%A1.html" aria-label="veth-pair和host网桥通信"><!---->veth-pair和host网桥通信<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/kubernetes/veth-pair%E5%92%8Covs-bridge%E9%80%9A%E8%AE%AF.html" aria-label="veth-pair和ovs-bridge通讯"><!---->veth-pair和ovs-bridge通讯<!----></a></li></ul></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/intro.html" aria-label="介绍页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span><!--]-->介绍页<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon fa-fw fa-sm fas fa-object-group" style=""></span>如何安装kubernetes</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://weiqiangxu.github.io" target="_blank" rel="noopener noreferrer">xuweiqiang</a></span><span property="author" content="xuweiqiang"></span></span><!----><!----><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 19 分钟</span><meta property="timeRequired" content="PT19M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color2 clickable" role="navigation">kubernetes</span><!--]--><meta property="articleSection" content="kubernetes"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color2 clickable" role="navigation">kubernetes</span><!--]--><meta property="keywords" content="kubernetes"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#一、环境准备">一、环境准备</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#二、安装二进制程序">二、安装二进制程序</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#三、部署集群中flannel网络插件">三、部署集群中Flannel网络插件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#四、部署nginx服务测试集群">四、部署nginx服务测试集群</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#五、其他节点部署服务并加入到集群之中">五、其他节点部署服务并加入到集群之中</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#六、相关疑问">六、相关疑问</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#相关资料">相关资料</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content" vp-content><blockquote><p>使用kubeadm搭建kubenertes环境</p></blockquote><h3 id="一、环境准备" tabindex="-1"><a class="header-anchor" href="#一、环境准备"><span>一、环境准备</span></a></h3><p>CentOS 7.6 64bit 2核 2G * 2 ( 操作系统的版本至少在7.5以上 )</p><p><a href="https://v1-26.docs.kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/" target="_blank" rel="noopener noreferrer">1.环境准备之 kubernetes v1.26 CRI</a><a href="https://v1-26.docs.kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/" target="_blank" rel="noopener noreferrer">2.使用部署工具kubeadm安装 kubernetes v1.26</a></p><h4 id="_1-防火墙" tabindex="-1"><a class="header-anchor" href="#_1-防火墙"><span>1.防火墙</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> firewalld</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> disable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> firewalld</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> firewalld</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-设置主机名" tabindex="-1"><a class="header-anchor" href="#_2-设置主机名"><span>2.设置主机名</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 在master节点执行</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hostnamectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set-hostname</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> k8s-master</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 在其他节点执行</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hostnamectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set-hostname</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> k8s-node1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看当前主机名称</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uname</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-主机域名解析" tabindex="-1"><a class="header-anchor" href="#_3-主机域名解析"><span>3.主机域名解析</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 获取本机在本地网络中的ip地址</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ifconfig输出的是 网络接口，各个网络接口</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 一般是ifconfig的第一个网络接口eth0的ipV4</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># etho的全称是 Ethernet interface 0,表示第一块以太网网卡的接口</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 还有其他网络接口比如docker0(docker创建的虚拟网络接口用于容器之间、容器与主机通信)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 网络接口lo全称是loopback：本地回环接口，主机与自己通话用的</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ifconfig的eth0的ipV4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 注意：这里的IP地址是机器的局域网IP地址</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&lt; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">10.16.203.44 k8s-master</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看设置的内容</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/hosts</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-统一时间" tabindex="-1"><a class="header-anchor" href="#_4-统一时间"><span>4.统一时间</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看当前时间</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> date</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ntpdate是一个程序</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 用于在Linux或其他类Unix操作系统中同步计算机时钟与网络时间协议（NTP）服务器的系统时间</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 它可以在启动时自动更新系统时间，或者手动运行以进行时间同步</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ntpdate</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ntpdate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> time.windows.com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-关闭selinux" tabindex="-1"><a class="header-anchor" href="#_5-关闭selinux"><span>5.关闭selinux</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看是否安装SELinux模块</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># rpm Linux操作系统上管理RPM软件包的命令行工具</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rpm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -q</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> selinux-policy</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#查看selinux是否开启</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> getenforce</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 永久关闭selinux，需要重启</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 使用sed工具在/etc/selinux/config文件中查找包含“enforcing”的行并将其替换为“disabled”</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/enforcing/disabled/&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/selinux/config</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-txt line-numbers-mode" data-highlighter="shiki" data-ext="txt" data-title="txt" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>SELinux（Security-Enhanced Linux） 安全机制，更为细粒度的安全策略控制</span></span>
<span class="line"><span>要查看SELinux是否启用，可以在终端输入以下命令：getenforce</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Enforcing 强制模式</span></span>
<span class="line"><span>Permissive 宽容模式</span></span>
<span class="line"><span>Disabled 被禁用</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-关闭swap分区" tabindex="-1"><a class="header-anchor" href="#_6-关闭swap分区"><span>6.关闭swap分区</span></a></h4><p>Linux swap分区是一种特殊的分区，为内存不足时提供交换空间，可以将一部分硬盘空间作为虚拟内存使用。当物理内存不足时，系统将部分不常用的数据和进程暂存到swap分区中，以释放物理内存。swap分区对于提高系统的稳定性和可靠性非常重要。</p><p>要查看Linux系统中是否存在swap分区，可以使用以下命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 没有输出表示当前系统并没有启用swap分区</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> swapon</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --show</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 关闭已经启用的swap分区</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> swapoff</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重新开启swap分区</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> swapon</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 永久关闭swap分区，需要重启：</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 使用sed工具在/etc/fstab文件中查找任何包含“swap”的行</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 并在每行前加上“#”注释符，从而将它们全部注释掉</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -ri</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/.*swap.*/#&amp;/&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/fstab</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看包含swap的行是否已经注释</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/fstab</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> swap</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-启用桥接网络模块的ipv6-ipv4-数据包过滤功能" tabindex="-1"><a class="header-anchor" href="#_7-启用桥接网络模块的ipv6-ipv4-数据包过滤功能"><span>7.启用桥接网络模块的IPv6\IPv4 数据包过滤功能</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启用桥接网络模块的 IPv6 数据包过滤功能</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启用桥接网络模块的 IPv4 数据包过滤功能</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 系统会在下次启动时自动加载这些参数</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/sysctl.d/k8s.conf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&lt; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">net.bridge.bridge-nf-call-iptables = 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重新加载系统参数并应用任何更改</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 通常用于修改系统级别的参数，例如内核参数、网络配置等</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sysctl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --system</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="8"><li>安装</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 如果有一些工具没有安装</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bridge-utils</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ebtable</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> network.service</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 开启bridge相关的内核模块</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># modprobe是Linux中用于加载内核模块的命令</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># br_netfilter是Linux内核网络功能的一个模块</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 用于实现网络桥接口的内核网络过滤器功能</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> modprobe</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> br_netfilter</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ip_forward控制Linux内核是否开启IP包转发功能</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 如果不开启，则无法实现网络之间的数据传输</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 开启ip_forward</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 更改为1则永久开启IP包转发功能</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将下面的net.ipv4.ip_forward的一行的值更改为1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 如果没有添加一行 net.ipv4.ip_forward = 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/sysctl.conf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> net.ipv4.ip_forward</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 刷新配置</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sysctl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 验证更改是否成功</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sysctl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> net.ipv4.ip_forward</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二、安装二进制程序" tabindex="-1"><a class="header-anchor" href="#二、安装二进制程序"><span>二、安装二进制程序</span></a></h3><h4 id="_1-containerd安装" tabindex="-1"><a class="header-anchor" href="#_1-containerd安装"><span>1.containerd安装</span></a></h4><p><a href="https://weiqiangxu.github.io/2023/05/06/k8s/containerd%E5%AE%89%E8%A3%85/" target="_blank" rel="noopener noreferrer">containerd v1.7.0 的安装</a></p><p>更改镜像地址 /etc/containerd/config.yml:</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 注意这里因为网络原因更改sanbox镜像地址否则会无法kubeadm init</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">plugins.&quot;io.containerd.grpc.v1.cri&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  sandbox_image = &quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.5&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-添加kubernetes镜像源" tabindex="-1"><a class="header-anchor" href="#_2-添加kubernetes镜像源"><span>2.添加kubernetes镜像源</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 注意下面的mirrors是区分架构的</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看当前机器的架构</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> arch</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 访问地址 https://mirrors.aliyun.com/kubernetes/yum/repos 获取所有架构镜像源</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 更改下面的 baseurl</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 这里需要yum工具</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 注意执行之前确保baseurl后面的镜像源架构是否匹配</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/yum.repos.d/kubernetes.repo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&lt; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[kubernetes]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">name=Kubernetes</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">enabled=1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">gpgcheck=0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">repo_gpgcheck=0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 更新缓存</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clean</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> all</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> makecache</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-安装kubeadm-v1-27-1-kubelet-v1-27-1-kubectl-v1-27-1" tabindex="-1"><a class="header-anchor" href="#_3-安装kubeadm-v1-27-1-kubelet-v1-27-1-kubectl-v1-27-1"><span>3.安装kubeadm v1.27.1\kubelet v1.27.1\kubectl v1.27.1</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 在线安装</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubelet-1.27.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm-1.27.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl-1.27.1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启用kubelet服务,开机自启动</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubelet</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> json</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubelet</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --version</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 移除kubelet的CNI网络插件设置</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 文件`/var/lib/kubelet/kubeadm-flags.env`中</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将所有的`--network-plugin=cni`字符串替换为空字符串</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/--network-plugin=cni//&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/lib/kubelet/kubeadm-flags.env</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubelet</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置在Kubernetes集群中使用Flannel网络插件时的CNI插件参数</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Flannel是一种软件定义网络（SDN）解决方案，它使用虚拟网络来连接容器和节点</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 需要在集群中的每个节点上配置Flannel CNI插件参数</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 以便容器运行环境能够正确使用Flannel网络插件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/cni/net.d</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/cni/net.d/10-flannel.conf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">{</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  &quot;name&quot;: &quot;cbr0&quot;,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  &quot;cniVersion&quot;: &quot;0.2.0&quot;,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  &quot;type&quot;: &quot;flannel&quot;,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  &quot;delegate&quot;: {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    &quot;isDefaultGateway&quot;: true</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  }</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">} </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你想要离线安装，二进制文件下载可以访问<a href="https://kubernetes.io/releases/download/" target="_blank" rel="noopener noreferrer">Kubernetes文档/入门/下载Kubernetes</a> 或者 <a href="https://www.downloadkubernetes.com/" target="_blank" rel="noopener noreferrer">https://www.downloadkubernetes.com/</a>，kubeadm和kubectl可以直接离线二进制文件移动至/usr/bin完成安装，而kubelet需要systemend注册，比较麻烦可以通过离线下载rpm包的方式进行安装.详细说明查看 <a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/kubelet-integration/#the-kubelet-drop-in-file-for-systemd" target="_blank" rel="noopener noreferrer">kubelet 的 systemd drop-in 文件</a></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 如果需要离线安装建议下载rpm包</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum-utils</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yumdownloader</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --resolve</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubelet-1.27.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm-1.27.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl-1.27.1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 下载后所有的kubelet-1.27.1-0.x86_64.rpm\kubeadm-1.27.1-0.x86_64.rpm等</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 以及libnetfilter_cthelper-1.0.0-11.el7.x86_64.rpm之类的依赖</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 手动安装文件夹下面所有的rpm包</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rpm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -ivh</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.rpm</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubelet</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-安装cni插件" tabindex="-1"><a class="header-anchor" href="#_4-安装cni插件"><span>4.安装CNI插件</span></a></h4><p>CNI插件是二进制文件移动到系统环境变量里面完成安装，各个架构下的各个版本下载可以访问<a href="https://github.com/containernetworking/plugins/releases" target="_blank" rel="noopener noreferrer">github.com/containernetworking/plugins</a></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># https://github.com/containernetworking/plugins/releases</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 进入下载页根据架构选择安装包</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> arch</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aarch64</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># AArch64是一种ARMv8架构</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://github.com/containernetworking/plugins/releases/download/v1.2.0/cni-plugins-linux-arm64-v1.2.0.tgz</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 解压至/opt/cni/bin/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tar</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> xvf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cni-plugins-linux-arm64-v1.2.0.tgz</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -C</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /opt/cni/bin/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># or 先解压，后移动bin,注意这个插件很重要</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mv</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /home/cni-plugins-linux-arm64-v1.2.0/</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /opt/cni/bin/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-kubeadm初始化集群" tabindex="-1"><a class="header-anchor" href="#_6-kubeadm初始化集群"><span>6.kubeadm初始化集群</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看k8s所需的镜像</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> images</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> list</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 可以提前拉好镜像</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> images</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --image-repository</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> registry.aliyuncs.com/google_containers</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 部署k8s的master节点</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># apiserver-advertise-address更改为部署master的节点的</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 局域网IP地址(默认值是本地网络接口中第一个非回环地址,使用ifconfig查看所有网络接口)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># pod-network-cidr 集群中Pod的IP地址段 常用的有10.244.0.0/16</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># service-cidr.集群中Service的IP地址段.默认为10.96.0.0/12</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> init</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --apiserver-advertise-address=192.168.18.100</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --image-repository</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> registry.aliyuncs.com/google_containers</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --kubernetes-version</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> v1.27.1</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --service-cidr=10.96.0.0/12</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --pod-network-cidr=10.244.0.0/16</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 可以使用简单版本 ,apiserver-advertise-address使用默认值</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 注意v1.27.1搭配docker需要额外安装cri-dockerd </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> init</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --apiserver-advertise-address=10.16.203.44</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --image-repository</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> registry.aliyuncs.com/google_containers</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --kubernetes-version</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> v1.27.1</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --service-cidr=10.96.0.0/12</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --pod-network-cidr=10.244.0.0/16</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --v=5</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">### kubueadm init 失败的时候</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reset</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重新init的时候带上 --v=5 查看详细</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># kubeadm生成默认配置并且用来启动</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> print</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> init-defaults</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">init.default.yaml</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> init</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --config=init.default.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 在你执行kubectl get ns之前拷贝一下配置</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 在你执行kubectl get ns之前拷贝一下配置</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 在你执行kubectl get ns之前拷贝一下配置</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@k8s-master ~]# mkdir -p </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$HOME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/.kube</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@k8s-master ~]# sudo cp -i /etc/kubernetes/admin.conf </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$HOME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/.kube/config</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@k8s-master ~]# sudo chown $(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">id</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">id</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -g</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$HOME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/.kube/config</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@k8s-master ~]# kubectl get pod</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 否则会抛异常</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@k8s-master home]# kubectl get pod</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">W0522</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:32:07.948191</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  915987</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> request.go:1480]</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> not</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> healthz</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> host</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trigger</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> upate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> base</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> url:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost:8080:6443</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">W0522</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:32:07.950403</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  915987</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> request.go:1480]</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> not</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> healthz</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> host</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trigger</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> upate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> base</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> url:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost:8080:6443</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">W0522</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:32:07.952802</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  915987</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> request.go:1480]</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> not</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> healthz</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> host</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trigger</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> upate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> base</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> url:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost:8080:6443</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">W0522</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:32:07.955076</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  915987</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> request.go:1480]</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> not</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> healthz</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> host</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trigger</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> upate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> base</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> url:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost:8080:6443</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">W0522</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 18:32:07.957487</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  915987</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> request.go:1480]</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> not</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> healthz</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> host</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> trigger</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> upate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> base</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> url:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost:8080:6443</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@i-C5B261D3 home]# kubeadm version</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">version.Info</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">{Major:</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;1&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Minor:&quot;22&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> GitVersion:&quot;v1.22.21&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> GitCommit:&quot;ca62f64bd6397f9ab41f68c22d2d48d87d8edb91&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> GitTreeState:&quot;clean&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BuildDate:&quot;2023-01-15T13:33:59Z&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> GoVersion:&quot;go1.17.1&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Compiler:&quot;gc&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Platform:&quot;linux/arm64&quot;}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 这个不知道为啥 </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 为啥 kube-controller-manager 和 kube-scheduler 是Exited的状态</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@k8s-master home]# crictl ps -a</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CONTAINER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">           IMAGE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">               CREATED</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             STATE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">               NAME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                      ATTEMPT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             POD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ID</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">d529ea99a5dda</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       20654f2150dd5</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       Exited</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              kube-controller-manager</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                   26d5a6aaca513</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bcb291b686f32</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       717e2b2b33bd0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       Exited</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              kube-scheduler</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            16</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                  93a27ed44a6fb</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">efed94a74ba8c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       78d0a9e0b092c</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       17</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      Running</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             kube-apiserver</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                   48c0c294eeeca</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">924e523f0b13c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       2252d5eb703b0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       17</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      Running</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             etcd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                      4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                   0fe680e794e71</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 生成的 init.default.yaml 配置</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">kubeadm.k8s.io/v1beta3</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bootstrapTokens</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groups</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">system:bootstrappers:kubeadm:default-node-token</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  token</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">abcdef.0123456789abcdef</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  ttl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">24h0m0s</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  usages</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">signing</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">authentication</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">InitConfiguration</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">localAPIEndpoint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 1.更改为当前局域网IP地址</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  advertiseAddress</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10.16.203.44</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  bindPort</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6443</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">nodeRegistration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 2.更改CRI，默认是docker如果用containerd需要更改</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  criSocket</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/run/containerd/containerd.sock</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  imagePullPolicy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">IfNotPresent</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 3.更改为hostname</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">k8s-master</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  taints</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">---</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">apiServer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  timeoutForControlPlane</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">4m0s</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">kubeadm.k8s.io/v1beta3</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">certificatesDir</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/kubernetes/pki</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">clusterName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">kubernetes</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">controllerManager</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dns</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">etcd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  local</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    dataDir</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/var/lib/etcd</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 4.更改镜像为国内镜像</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">imageRepository</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">registry.aliyuncs.com/google_containers</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ClusterConfiguration</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 5.更改目标kubernetes版本</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">kubernetesVersion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1.22.0</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">networking</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  dnsDomain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cluster.local</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 6.设置集群中Pod的IP地址段</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  podSubnet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">172.16.0.0/16</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 7.设置集群中Service的IP地址段</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  serviceSubnet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">10.96.0.0/12</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">scheduler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 执行初始化集群，如果已经初始化集群的则 kubeadm reset 一下</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 注意：kubeadm reset 不会删除 $HOME/.kube</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 所以 kubeadm reset之后手动删除 $HOME/.kube</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> init</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --config=init.default.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>kubeadm reset之后手动删除 $HOME/.kube</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看集群所有容器</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> crictl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ps</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>为啥 <code>ctr c list</code> 查看不到k8s的所有容器呢</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看contianerd是否正常</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 可能看到/etc/containerd/config.yml的sandbox_image pull fail</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 可以改成 registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.5</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> journalctl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -xeu</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> containerd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --no-pager</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 监听containerd</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> journalctl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -xeu</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubelet</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> journalctl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -xeu</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> containerd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看是否有containerd的镜像启动</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ctr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --help</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#docker" target="_blank" rel="noopener noreferrer">k8s v1.27.1默认移除dockershim，需要安装cri-dockerd</a></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建成功输出</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Your</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Kubernetes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> control-plane</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> has</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> initialized</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> successfully!</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> join</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 192.168.1.1:6443</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --token</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> xxx.xx</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --discovery-token-ca-cert-hash</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sha256:xxx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-配置kubectl环境" tabindex="-1"><a class="header-anchor" href="#_7-配置kubectl环境"><span>7.配置kubectl环境</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置信息指定Kubernetes API的访问地址、认证信息、命名空间、资源配额以及其他配置参数</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $HOME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/.kube</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将admin.conf复制到当前用户的$HOME/.kube/config</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># kubectl命令在使用时默认使用该文件</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 否则使用kubectl命令时必须明确指定配置文件路径或设置环境变量</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cp</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/kubernetes/admin.conf</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $HOME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/.kube/config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将配置文件的所有权赋予给当前用户</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chown</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> $(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">id</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">id</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -g</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$HOME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/.kube/config</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="三、部署集群中flannel网络插件" tabindex="-1"><a class="header-anchor" href="#三、部署集群中flannel网络插件"><span>三、部署集群中Flannel网络插件</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看节点状态</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 使用kubectl工具将kube-flannel.yml文件中定义的Flannel网络插件之中</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Deployment、DaemonSet、ServiceAccount等Kubernetes资源部署到集群中</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 从而为集群中的宿主机和容器、容器间提供网络互联功能</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://github.com/flannel-io/flannel/releases/download/v0.21.5/kube-flannel.yml</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apply</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kube-flannel.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看集群pods确认是否成功</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pods</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kube-system</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看集群健康状况(显示了控制平面组件</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Control Plane Component）的健康状态</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># etcd/kube-apiserver/kube-controller-manager/kube-scheduler</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 显示集群的相关信息(DNS\证书\密钥等)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cluster-info</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>kubectl怎么安装flannel的,新添加的节点又是如何安装flannel的呢,在文件夹/etc/cni/net.d的配置是如何拷贝的呢,请访问<a href="https://zhuanlan.zhihu.com/p/450140876" target="_blank" rel="noopener noreferrer">K8s网络之深入理解CNI</a></p><h3 id="四、部署nginx服务测试集群" tabindex="-1"><a class="header-anchor" href="#四、部署nginx服务测试集群"><span>四、部署nginx服务测试集群</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 部署Nginx</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> deployment</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --image=nginx:1.14-alpine</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 暴露端口</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> expose</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> deployment</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --port=80</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --type=NodePort</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看服务状态需要看到nginx服务为running</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pods,svc</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 访问nginx服务需要看到输出Welcome to nginx!</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> curl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> k8s-master:30185</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="五、其他节点部署服务并加入到集群之中" tabindex="-1"><a class="header-anchor" href="#五、其他节点部署服务并加入到集群之中"><span>五、其他节点部署服务并加入到集群之中</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># worker node 安装Docker/kubeadm/kubelet/kubectl</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># master节点生成token(2小时过期)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> token</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --print-join-command</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># master节点生成一个永不过期的token</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> token</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --ttl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --print-join-command</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 在worker node执行</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># --token：用于新节点加入集群的令牌</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># --discovery-token-ca-cert-hash：用于验证令牌的证书哈希值(集群初始化生成)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># --control-plane：如果要将新节点添加到控制平面，则需要指定此选项</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># --node-name：指定新节点的名称</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> join</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 192.168.18.100:6443</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --token</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> xxx</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --discovery-token-ca-cert-hash</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sha256:xxx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="六、相关疑问" tabindex="-1"><a class="header-anchor" href="#六、相关疑问"><span>六、相关疑问</span></a></h3><ul><li>kubeadmn如何重新初始化</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reset</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查看pod详情</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> describe</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pod</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $pod_name</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> describe</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx-deployment-xxx</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> describe</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mongodb</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NamespaceName</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>run/flannel/subnet.env无法找到</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 当错误是/run/flannel/subnet.env无法找到时候手动创建subnet.env内容是</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FLANNEL_NETWORK=10.244.0.0/16</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FLANNEL_SUBNET=10.244.0.1/24</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FLANNEL_MTU=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1450</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FLANNEL_IPMASQ=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>docker离线安装包</li></ul><div class="language-txt line-numbers-mode" data-highlighter="shiki" data-ext="txt" data-title="txt" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>Docker离线安装包官方下载链接：</span></span>
<span class="line"><span>Docker Engine: https://docs.docker.com/engine/install/binaries/</span></span>
<span class="line"><span>Docker Compose: https://github.com/docker/compose/releases</span></span>
<span class="line"><span>Docker Machine: https://github.com/docker/machine/releases</span></span>
<span class="line"><span>注意：离线安装包的下载可能比在线安装包的下载时间更长，建议选择适合自己网络和设备的安装方式。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>路径的docker.repo是干嘛的</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/yum.repos.d/docker.repo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># etc/yum.repos.d/docker.repo 是一个yum源配置文件，用于添加docker的官方仓库到yum源中。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 通过该文件，可以使用yum命令在CentOS/RHEL系统中安装、更新、卸载docker软件包</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>ebtables 和bridge-utils 是干嘛的</p><p>ebtables是一种基于Linux内核的防火墙软件，可以实现在数据包到达网络接口之前或之后对其进行过滤、修改等操作。ebtables是专门用于网桥设备的防火墙，可以识别和处理以太网帧，可以基于MAC地址、VLAN标签等进行过滤和转发操作。</p><p>bridge-utils是一组用于配置和管理Linux内核中的网络桥设备的命令行工具。它可以进行网桥的创建、删除、配置等操作。bridge-utils提供了一些命令行工具，例如brctl，可以用来查询、设置和管理网络桥接口，如添加和删除网桥、添加和删除网桥端口、设置网桥参数等。通过bridge-utils，用户可以方便地搭建以太网桥接网络，实现不同物理网络间的数据转发和通信。</p></li><li><p>Failed to download metadata for repo ‘docker-ce-stable</p></li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/yum.repos.d</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum-config-manager</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --add-repo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://download.docker.com/linux/centos/docker-ce.repo</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>yum-config-manager --add-repo干嘛用的</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>yum-config-manager --add-repo用于添加一个新的yum软件源地址，并将其保存在yum配置文件中</span></span>
<span class="line"><span>以便yum命令可以从该软件源中下载和安装软件包。该命令可以帮助用户获得更多的软件源</span></span>
<span class="line"><span>以便在软件包依赖项解决方案中更好地满足其需求。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>kubueadm 的--pod-network-cidr是什么</li></ul><p>&quot;kubeadm --pod-network-cidr&quot; 是一个命令行参数，用于指定 Kubernetes 集群中 Pod 网络的 CIDR 范围。这个参数需要在初始化 Kubernetes 集群时使用，在部署网络插件时使用。Pod 网络 CIDR 是一个 IP 地址段，用于定义 Kubernetes 集群中 Pod 之间通信的网络地址。这个 CIDR 范围定义了 Kubernetes 集群中 Pod 网络的 IP 地址。常见的 CIDR 范围包括 10.244.0.0/16、172.16.0.0/16 等。正确设置 Pod 网络 CIDR 很重要，因为它对 Kubernetes 集群的网络和通信架构有重要的影响。</p><ul><li>kuernetes.repo</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># repo地址</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/yum.repos.d/kubernetes.repo</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&lt; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/yum.repos.d/kubernetes.repo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[kubernetes]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">name=Kubernetes</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">enabled=1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">gpgcheck=1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">repo_gpgcheck=1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>kube-flannel是干嘛的</li></ul><div class="language-txt line-numbers-mode" data-highlighter="shiki" data-ext="txt" data-title="txt" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>kube-flannel是一个CNI插件，用于为Kubernetes集群创建和管理网络。</span></span>
<span class="line"><span>它提供了一种简单而有效的方法，让容器在不同节点上进行通信，而无需手动配置网络。</span></span>
<span class="line"><span>kube-flannel使用VXLAN或UDP封装技术来创建一个覆盖整个集群的扁平网络，</span></span>
<span class="line"><span>使得Kubernetes Pod能够互相通信，同时确保网络性能的高效和可靠性。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>k8s的控制平面有哪些</li></ul><ol><li>kube-apiserver：Kubernetes API服务器，提供Kubernetes API的访问入口，以及对Kubernetes内部对象的认证、授权和验证。</li><li>etcd：Kubernetes使用etcd作为其默认的分布式键值存储系统，用于存储Kubernetes集群的所有配置数据、元数据和状态信息。</li><li>kube-scheduler：负责将新创建的Pod调度到集群中的Node上，选择最佳的Node来运行Pod。</li><li>kube-controller-manager：Kubernetes控制器管理器，包含了多个控制器，用于自动化管理Kubernetes集群中的各种资源和对象。</li><li>cloud-controller-manager：云控制器管理器，负责管理云平台上的资源，如EC2、ELB等，并将这些资源与Kubernetes集群进行集成。</li></ol><blockquote><p>这些组件共同组成了Kubernetes控制平面，负责管理和控制整个Kubernetes集群的运行状态。</p></blockquote><ul><li>检查 IP 为 192.168.1.1 的计算机的端口 80 是否开放</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> telnet</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> telnet</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 192.168.1.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 80</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>kubectl get svc的输出解释</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NAME：Service名称。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> TYPE：Service类型。通常有ClusterIP、NodePort、LoadBalancer和ExternalName四种类型。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CLUSTER-IP：Service的Cluster</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IP地址。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EXTERNAL-IP：Service的外部IP地址（仅适用于LoadBalancer类型）。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PORT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">S</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">：Service暴露的端口号和协议。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> AGE：Service被创建后的时间。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">例如，以下是一段</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get svc`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">命令的输出结果：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NAME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">           TYPE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">           CLUSTER-IP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      EXTERNAL-IP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     PORT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">S</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)          </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">AGE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">my-service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     ClusterIP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      10.0.0.5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">non</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;          </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">80/TCP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">           5d</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">app-service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    LoadBalancer</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   10.0.0.15</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       203.0.113.10</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   80:30000/TCP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     2d</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">解释：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">my-service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">是一个ClusterIP类型的Service，其Cluster</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IP地址为`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">10.0.0.5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">，暴露的端口号为80/TCP。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">app-service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">是一个LoadBalancer类型的Service，其Cluster</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IP地址为`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">10.0.0.15</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    暴露的端口号为80/TCP，同时外部IP地址为</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">203.0.113.10</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">，将请求转发到NodePort</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">30000</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">上</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>kubeadm config print init-defaults</li></ul><div class="language-txt line-numbers-mode" data-highlighter="shiki" data-ext="txt" data-title="txt" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>kubeadm config print init-defaults 是一个命令，用于打印 kubeadm 初始化时的默认配置。</span></span>
<span class="line"><span>这个命令可以帮助用户了解 kubeadm 在默认情况下会使用哪些配置，以及这些配置如何影响 Kubernetes 集群的部署和运行。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>containerd出现异常 failed to pull and unpack image &quot;registry.k8s.io/pause:3.8&quot;</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 镜像拉取失败</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ctr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> registry.k8s.io/pause:3.8</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 需要配置sanbox为</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sandbox_image</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.5&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>kubeadm init的时候监听日志</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> journalctl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -xeu</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubelet</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><a href="https://docker-practice.github.io/zh-cn/kubernetes/setup/kubeadm.html" target="_blank" rel="noopener noreferrer">使用 kubeadm 部署 kubernetes(CRI 使用 containerd)</a></p><ul><li>linux怎么样验证一个端口通不通</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># telnet</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> telnet</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> ${</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">IP地址</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> ${</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">端口号</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> telnet</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 192.168.1.10</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 80</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># success</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Connected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $ip</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>telnet 127.0.0.1 30022 出现Connection refused</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 没有运行正在监听30022端口的服务或防火墙等安全设置阻止了连接</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> firewall-cmd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --state</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> firewall-cmd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --list-ports</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>只有master节点无法调度怎么办</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 获取节点信息</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubuctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> node</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看当前mster节点所有taint</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 输出之中所有的Taints:node.kubernetes.io/not-ready:NoExecute...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> describe</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> node</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 取消标记语法</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> taint</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">master-node-nam</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">node-role.kubernetes.io/master:NoSchedule-</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 取消2个标记</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> taint</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> k8s-master</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> node.kubernetes.io/not-ready:NoExecute-</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> taint</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> k8s-master</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> node.kubernetes.io/not-ready:NoSchedule-</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> taint</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> k8s-master</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> node-role.kubernetes.io/master:NoSchedule-</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>k8s会默认设置Taints在主节点吗</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 给主节点打上一个Key为`node-role.kubernetes.io/master`，value为`NoSchedule`的Taint，即在主节点上设置Taints</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># kubectl taint nodes `master-node-name` node-role.kubernetes.io/master=:NoSchedule</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">默认情况下，Kubernetes会在主节点上设置Taints。这是为了确保主节点不被普通的Pod调度和运行。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">只有具有对应Tolerations的Pod才能被调度和运行在主节点上。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">这可以确保主节点保持稳定和安全，防止普通的Pod对主节点产生负面影响。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>yum怎么下载rpm安装包</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum-utils</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yumdownloader</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --resolve</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker-ce-18.06.3.ce-3.el7</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Port 10250 is in use</li></ul><blockquote><p>$ kubeadm reset</p></blockquote><ul><li>k8s的默认CNI配置在哪里获取</li></ul><div class="language-log line-numbers-mode" data-highlighter="shiki" data-ext="log" data-title="log" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">默认情况下，Kubernetes使用CNI插件来管理容器网络，其中包括常见的插件如Flannel、Calico、Weave Net等。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>linux 的 /etc/cni/net.d/ 里面的配置是干嘛的</li></ul><p>/etc/cni/net.d/目录是用于存放Kubernetes CNI插件的配置文件的，默认情况下是在kubelet启动时从这个目录读取配置文件。Kubernetes的默认CNI插件是<code>kubelet</code>在启动时自动加载。在使用kubelet启动Kubernetes集群时，kubelet会检查<code>/etc/cni/net.d/</code>目录中是否存在<code>10-kubenet.conf</code>或<code>10-bridge.conf</code>文件。CNI插件是Kubernetes系统中用于管理网络的组件，它可以为不同的Pod分配IP地址、创建和删除网络接口等操作。在该目录下，可以指定使用哪一个CNI插件，并为该插件提供相应的配置参数，例如网络类型、IP地址池、MTU等等。不同的CNI插件有不同的配置方式，但这个目录是它们的公共配置目录。</p><ul><li>k8s安装以后有哪些服务</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># nginx是唯一的业务pod</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wide</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># NAMESPACE      NAME                                 READY   STATUS    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># default        nginx-55f8fd7cfc-vjqq5               1/1     Running</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># kube-flannel   kube-flannel-ds-fs2wf                1/1     Running</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># kube-system    coredns-7ff77c879f-hwjtl             1/1     Running  </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># kube-system    coredns-7ff77c879f-pqjdk             1/1     Running </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># kube-system    etcd-k8s-master                      1/1     Running </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># kube-system    kube-apiserver-k8s-master            1/1     Running</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># kube-system    kube-controller-manager-k8s-master   1/1     Running</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># kube-system    kube-proxy-5qzvn                     1/1     Running</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># kube-system    kube-scheduler-k8s-master            1/1     Running</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ifconfig 输出的 eth0是什么意思</li></ul><p>eth0是指计算机中的第一个以太网接口，通常用于连接本地网络或连接到互联网的路由器。该接口可以通过ifconfig命令进行配置和管理。</p><ul><li>ifconfig 输出的 eth0之中的 inet 和 inet6是什么意思</li></ul><p>ifconfig 输出的 eth0 中的 inet 和 inet6 是指该接口所分配的 IPv4 和 IPv6 地址。inet 是 IPv4 地址，inet6 是 IPv6 地址。这两个地址用于标识网络中的设备，以便它们可以相互通信。inet 和 inet6 地址是网络编程中常用的概念，它们分别对应着 IPv4 和 IPv6 协议，用于实现网络数据传输。</p><ul><li>couldn&#39;t get current server API group list: Get &quot;http://localhost:8080/api</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;export KUBECONFIG=/etc/kubernetes/admin.conf&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">~/.bash_profile</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> source</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ~/.bash_profile</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>CRI为containerd的k8s集群如何定位异常</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> crictl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ps</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> crictl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> logs</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> ${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">containerdID</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>k8s的版本怎么看，在安装了k8s集群的环境下</li></ul><p>可以通过 <code>$ kubectl version</code> 输出结果中会有两个版本号，一个是Client Version，一个是Server Version，其中Server Version即为当前集群的Kubernetes版本号。如果使用的是kubeadm搭建的集群，也可以通过 <code>$ kubeadm version</code> 输出结果中的kubernetes版本号即为当前集群的版本号。</p><ul><li>为什么安装了containerd的机器，执行 <code>ctr c list</code> 查看不到任何东西但是 <code>crictl ps -a</code> 却可以查看到容器列表</li></ul><p>可能是因为 <code>ctr c</code> 和 <code>crictl ps</code> 使用的不同的容器运行时。<code>ctr c</code> 是使用 containerd 运行时查看容器，而<code>crictl</code> 是使用 CRI (Container Runtime Interface) 运行时查看容器。因此，如果您使用的容器运行时与 containerd 不同，那么您可能无法使用 <code>ctr c</code> 查看容器。建议您使用 CRI 运行时，使用 <code>crictl ps</code> 来查看容器。</p><h3 id="相关资料" tabindex="-1"><a class="header-anchor" href="#相关资料"><span>相关资料</span></a></h3><p><a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/" target="_blank" rel="noopener noreferrer">kubernetes.io/zh-cn/安装kubeadm</a><a href="https://download.docker.com/linux/static/stable" target="_blank" rel="noopener noreferrer">官方docker离线安装</a><a href="https://mirrors.aliyun.com/kubernetes/yum/repos/" target="_blank" rel="noopener noreferrer">kubernetes/yum/repos各个架构下的</a><a href="https://zhuanlan.zhihu.com/p/602370492" target="_blank" rel="noopener noreferrer">zhihu/k8s 1.16.0 版本的coreDNS一直处于pending状态的解决方案</a><a href="https://blog.csdn.net/qq_41586875/article/details/124688043" target="_blank" rel="noopener noreferrer">k8s部署flannel时报failed to find plugin /opt/cni/bin</a><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/" target="_blank" rel="noopener noreferrer">kubernetes.io使用kubeadm安装集群</a><a href="https://kubernetes.io/zh-cn/docs/reference/setup-tools/kubeadm/kubeadm-init/#without-internet-connection" target="_blank" rel="noopener noreferrer">离线运行kubeadm初始化集群</a></p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/weiqiangxu/docs/edit/main/src/posts/kubernetes/如何安装kubernetes.md" aria-label="在 GitHub 上编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/posts/kubernetes/%E5%88%9B%E5%BB%BAservice%E6%8C%87%E5%90%91%E5%A4%96%E9%83%A8%E6%9C%8D%E5%8A%A1.html" aria-label="创建service和endpoints指向外部服务"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><span class="font-icon icon fa-fw fa-sm fas fa-object-group" style=""></span>创建service和endpoints指向外部服务</div></a><a class="route-link auto-link next" href="/posts/kubernetes/Kubernetes%E7%BB%84%E4%BB%B6.html" aria-label="Kubernetes组件"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">Kubernetes组件<span class="font-icon icon fa-fw fa-sm fas fa-object-group" style=""></span></div></a></nav><!----><!----><!--]--></main><!--]--><!----></div><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.a217d4a6.js" defer></script><script src="/assets/js/4596.7214a8f8.js" defer></script><script src="/assets/js/app.996ba4c1.js" defer></script>
  </body>
</html>
