"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8043],{6262:(i,s)=>{s.A=(i,s)=>{const a=i.__vccOpts||i;for(const[i,n]of s)a[i]=n;return a}},3172:(i,s,a)=>{a.r(s),a.d(s,{comp:()=>l,data:()=>h});var n=a(641);const e={},l=(0,a(6262).A)(e,[["render",function(i,s){return(0,n.uX)(),(0,n.CE)("div",null,s[0]||(s[0]=[(0,n.Fv)('<h3 id="一、抓包理解tcp连接" tabindex="-1"><a class="header-anchor" href="#一、抓包理解tcp连接"><span>一、抓包理解tcp连接</span></a></h3><ol><li>使用golang做tcp网络编程创建client &amp;&amp; server</li><li>使用tcpdump监听客户端和服务端的连接情况</li></ol><h5 id="_1-tcpdump" tabindex="-1"><a class="header-anchor" href="#_1-tcpdump"><span>1.tcpdump</span></a></h5><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># client</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tcpdump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lo0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> host</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dst</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 9292</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># server</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tcpdump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lo0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> host</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> src</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 9292</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-三次握手" tabindex="-1"><a class="header-anchor" href="#_2-三次握手"><span>2.三次握手</span></a></h5><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># src 9292</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:38:22.028257</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1.9292</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">127.0.0.1.50139:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [S.], seq 2936404470, ack 2399477565, win 65535, options [mss 16344,nop,wscale 6,nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2141525572</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 2939320578,sackOK,eol], length 0</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:38:22.028287</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1.9292</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">127.0.0.1.50139:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [.], ack 1, win 6379, options [nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2141525572</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 2939320578], length 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># dst 9292</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:38:22.028149</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1.50139</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">127.0.0.1.9292:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [S], seq 2399477564, win 65535, options [mss 16344,nop,wscale 6,nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2939320578</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 0,sackOK,eol], length 0</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:38:22.028278</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1.50139</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">127.0.0.1.9292:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [.], ack 2936404471, win 6379, options [nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2939320578</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 2141525572], length 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 简化一下</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">client</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [S],seq 2399477564, win 65535                     [SYN报文] [发完之后clent状态是SYN-SENT]</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [S.],seq 2936404470, ack 2399477565, win 65535    [报文发送后server状态是SYN-RCVD]</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">client</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [.],ack 2936404471, win 6379                      [报文发送后client状态是ESTABLISHED]  [注意这一次的报文可以携带客户端到服务端的数据了]</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                                 [服务端收到客户端报文后状态是ESTABLISHED]</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 注意seq值和ack值总是相差1</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 注意握手成功后双方的状态都是ESTABLISHED</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-四次挥手" tabindex="-1"><a class="header-anchor" href="#_3-四次挥手"><span>3.四次挥手</span></a></h5><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># dst 9292</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:44:13.099483</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1.50943</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">127.0.0.1.9292:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [F.], seq 0, ack 1, win 6379, options [nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1048610910</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 2373676954], length 0</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:44:13.099714</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1.50943</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">127.0.0.1.9292:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [.], ack 2, win 6379, options [nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1048610910</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 2373686619], length 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># src 9292</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:44:13.099535</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1.9292</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">127.0.0.1.50943:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [.], ack 2, win 6379, options [nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2373686619</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 1048610910], length 0</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">22:44:13.099681</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1.9292</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">127.0.0.1.50943:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [F.], seq 1, ack 2, win 6379, options [nop,nop,TS val </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2373686619</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ecr 1048610910], length 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 四次挥手</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">client</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [F.], seq 0, ack 1, win 6379</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [.], ack 2, win 6379</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [F.], seq 1, ack 2, win 6379</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">client</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   Flags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [.], ack 2, win 6379</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二、来学学tcp调优" tabindex="-1"><a class="header-anchor" href="#二、来学学tcp调优"><span>二、来学学TCP调优</span></a></h3><p><a href="https://mp.weixin.qq.com/s/fjnChU3MKNc_x-Wk7evLhg" target="_blank" rel="noopener noreferrer">换人！他连TCP这几个参数都不懂</a><a href="https://mp.weixin.qq.com/s/jomA0WT6zul1zrGzuBqOkA" target="_blank" rel="noopener noreferrer">收到RST，就一定会断开TCP连接吗？</a></p><h5 id="_1-调优大纲" tabindex="-1"><a class="header-anchor" href="#_1-调优大纲"><span>1.调优大纲</span></a></h5><ol><li>握手调优</li><li>挥手调优</li><li>传输调优</li></ol><h5 id="_2-握手调优" tabindex="-1"><a class="header-anchor" href="#_2-握手调优"><span>2.握手调优</span></a></h5><ol><li>client超时重传机制</li><li>server response &amp;&amp; Linux内核半连接队列溢出 &amp;&amp; 服务端重发SYN+ACK 报文 &amp;&amp; 服务端ESTABLISHED后变accept队列（全连接队列） &amp;&amp; 全连接队列溢出</li><li>client response</li></ol><h5 id="_3-报文" tabindex="-1"><a class="header-anchor" href="#_3-报文"><span>3.报文</span></a></h5><blockquote><p>SYN 的全称就叫 Synchronize Sequence Numbers(同步序列号)(TCP头部格式之中有保留的6位)</p></blockquote><ol><li>SYN</li><li>RST</li><li>FIN</li><li>ACK</li><li>URG</li><li>PSH</li></ol><h5 id="_4-状态流转" tabindex="-1"><a class="header-anchor" href="#_4-状态流转"><span>4.状态流转</span></a></h5><ol><li>SYN_SENT</li><li>SYN_RCV</li><li>ESTABLISHED</li></ol><h5 id="_5-nginx调整半连接队列大小backlog" tabindex="-1"><a class="header-anchor" href="#_5-nginx调整半连接队列大小backlog"><span>5.nginx调整半连接队列大小backlog</span></a></h5><h5 id="_6-syncookies" tabindex="-1"><a class="header-anchor" href="#_6-syncookies"><span>6.syncookies</span></a></h5><blockquote><p>开启 syncookies 功能就可以在不使用 SYN 半连接队列的情况下成功建立连接。</p></blockquote><h5 id="_7-syn攻击" tabindex="-1"><a class="header-anchor" href="#_7-syn攻击"><span>7.SYN攻击</span></a></h5><ul><li><p>服务器收到 ACK 后连接建立成功，accept队列（全连接队列）溢出，TCP连接被丢弃</p></li><li><p>服务端已经收到了ACK，但是因为accept队列（全连接队列）溢出导致TCP连接被丢弃，告知客户端的话，客户端异常会收到 connection reset by peer</p></li></ul><blockquote><p>服务端全连接队列溢出 connection reset by peer 正常来说服务端全连接溢出，server直接丢弃client.ack就好了，client过一会儿会自动重新发送ack 或者加大accpet队列长度</p></blockquote><h5 id="_8-如何查看server的accpet队列长度" tabindex="-1"><a class="header-anchor" href="#_8-如何查看server的accpet队列长度"><span>8.如何查看server的accpet队列长度</span></a></h5><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ss</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -ltn</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h5 id="_9-查看由于-accept-连接队列已满-而被丢弃的连接" tabindex="-1"><a class="header-anchor" href="#_9-查看由于-accept-连接队列已满-而被丢弃的连接"><span>9.查看由于 accept 连接队列已满，而被丢弃的连接</span></a></h5><h5 id="_10-如何理解http-请求必须在一个-rtt-从客户端到服务器一个往返的时间-后才能发送" tabindex="-1"><a class="header-anchor" href="#_10-如何理解http-请求必须在一个-rtt-从客户端到服务器一个往返的时间-后才能发送"><span>10.如何理解HTTP 请求必须在一个 RTT（从客户端到服务器一个往返的时间）后才能发送</span></a></h5><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">意味着</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> client</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SYN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 之后</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> response</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SYN+ACK</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 之后</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">client此时就可以发送数据了</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">注意此时服务端是半连接队列状态client就可以发送数据了</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RTT是一个往返</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_11-主动关闭连接的-才有-time-wait-状态" tabindex="-1"><a class="header-anchor" href="#_11-主动关闭连接的-才有-time-wait-状态"><span>11.主动关闭连接的，才有 TIME_WAIT 状态</span></a></h5><h5 id="_12-四次挥手的性能提升" tabindex="-1"><a class="header-anchor" href="#_12-四次挥手的性能提升"><span>12.四次挥手的性能提升</span></a></h5><h5 id="_13-滑动窗口是如何影响传输速度的" tabindex="-1"><a class="header-anchor" href="#_13-滑动窗口是如何影响传输速度的"><span>13.滑动窗口是如何影响传输速度的</span></a></h5><p>包的往返时间越长，网络的吞吐量就会越低；所以单程携带更多，就是批量发送报文批量处理报 文字</p><h5 id="_14-connection-reset-by-peer是什么意思-读" tabindex="-1"><a class="header-anchor" href="#_14-connection-reset-by-peer是什么意思-读"><span>14.Connection reset by peer是什么意思（读）</span></a></h5><p>应用层尝试去执行 读数据操作，比如recv，应用层就会收到 Connection reset by peer 的报错，意思是远端已经关闭连接</p><h5 id="_14-broken-pipe是什么意思-写" tabindex="-1"><a class="header-anchor" href="#_14-broken-pipe是什么意思-写"><span>14.Broken pipe是什么意思（写）</span></a></h5><p>应用层尝试去执行写数据操作，比如send，那么应用层就会收到 Broken pipe 的报错，意思是发送通道已经坏了</p>',42)]))}]]),h=JSON.parse('{"path":"/posts/network/tcp%E8%BF%9E%E6%8E%A5%E4%B8%8E%E6%8A%93%E5%8C%85.html","title":"TCP连接与抓包","lang":"zh-CN","frontmatter":{"title":"TCP连接与抓包","tags":["network"],"categories":["network"],"description":"一、抓包理解tcp连接 使用golang做tcp网络编程创建client && server 使用tcpdump监听客户端和服务端的连接情况 1.tcpdump 2.三次握手 3.四次挥手 二、来学学TCP调优 换人！他连TCP这几个参数都不懂 收到RST，就一定会断开TCP连接吗？ 1.调优大纲 握手调优 挥手调优 传输调优 2.握手调优 clien...","gitInclude":[],"head":[["meta",{"property":"og:url","content":"https://weiqiangxu.github.io/posts/network/tcp%E8%BF%9E%E6%8E%A5%E4%B8%8E%E6%8A%93%E5%8C%85.html"}],["meta",{"property":"og:site_name","content":"笔记本"}],["meta",{"property":"og:title","content":"TCP连接与抓包"}],["meta",{"property":"og:description","content":"一、抓包理解tcp连接 使用golang做tcp网络编程创建client && server 使用tcpdump监听客户端和服务端的连接情况 1.tcpdump 2.三次握手 3.四次挥手 二、来学学TCP调优 换人！他连TCP这几个参数都不懂 收到RST，就一定会断开TCP连接吗？ 1.调优大纲 握手调优 挥手调优 传输调优 2.握手调优 clien..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:tag","content":"network"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"TCP连接与抓包\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"xuweiqiang\\",\\"url\\":\\"https://weiqiangxu.github.io\\"}]}"]]},"headers":[{"level":3,"title":"一、抓包理解tcp连接","slug":"一、抓包理解tcp连接","link":"#一、抓包理解tcp连接","children":[]},{"level":3,"title":"二、来学学TCP调优","slug":"二、来学学tcp调优","link":"#二、来学学tcp调优","children":[]}],"readingTime":{"minutes":3.7,"words":1110},"filePathRelative":"posts/network/tcp连接与抓包.md","excerpt":"<h3>一、抓包理解tcp连接</h3>\\n<ol>\\n<li>使用golang做tcp网络编程创建client &amp;&amp; server</li>\\n<li>使用tcpdump监听客户端和服务端的连接情况</li>\\n</ol>\\n<h5>1.tcpdump</h5>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" data-title=\\"bash\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># client</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">sudo</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> tcpdump</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -i</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> lo0</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> host</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> localhost</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> and</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> dst</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> port</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> 9292</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -n</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># server</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">sudo</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> tcpdump</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -i</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> lo0</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> host</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> localhost</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> and</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> src</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> port</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> 9292</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -n</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}')}}]);