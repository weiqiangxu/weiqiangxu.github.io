"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1936],{6262:(n,s)=>{s.A=(n,s)=>{const a=n.__vccOpts||n;for(const[n,i]of s)a[n]=i;return a}},4179:(n,s,a)=>{a.r(s),a.d(s,{comp:()=>l,data:()=>p});var i=a(641);const e={},l=(0,a(6262).A)(e,[["render",function(n,s){return(0,i.uX)(),(0,i.CE)("div",null,s[0]||(s[0]=[(0,i.Fv)('<h3 id="lease-infomer" tabindex="-1"><a class="header-anchor" href="#lease-infomer"><span>lease infomer</span></a></h3><div class="language-golang line-numbers-mode" data-highlighter="shiki" data-ext="golang" data-title="golang" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>package main</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>import (</span></span>\n<span class="line"><span>\t&quot;context&quot;</span></span>\n<span class="line"><span>\tapiCoordinationV1 &quot;k8s.io/api/coordination/v1&quot;</span></span>\n<span class="line"><span>\tcoordinationV1 &quot;k8s.io/client-go/informers/coordination/v1&quot;</span></span>\n<span class="line"><span>\t&quot;k8s.io/client-go/kubernetes&quot;</span></span>\n<span class="line"><span>\t&quot;k8s.io/client-go/tools/cache&quot;</span></span>\n<span class="line"><span>\t&quot;k8s.io/client-go/tools/clientcmd&quot;</span></span>\n<span class="line"><span>\t&quot;k8s.io/client-go/util/homedir&quot;</span></span>\n<span class="line"><span>\t&quot;log&quot;</span></span>\n<span class="line"><span>\t&quot;path/filepath&quot;</span></span>\n<span class="line"><span>\t&quot;time&quot;</span></span>\n<span class="line"><span>)</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>func buildConfig() (*kubernetes.Clientset, error) {</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\tvar kubeConfigFile string</span></span>\n<span class="line"><span>\tif home := homedir.HomeDir(); home != &quot;&quot; {</span></span>\n<span class="line"><span>\t\tkubeConfigFile = filepath.Join(home, &quot;.kube&quot;, &quot;config&quot;)</span></span>\n<span class="line"><span>\t}</span></span>\n<span class="line"><span>\trestConfig, err := clientcmd.BuildConfigFromFlags(&quot;&quot;, kubeConfigFile)</span></span>\n<span class="line"><span>\tif err != nil {</span></span>\n<span class="line"><span>\t\treturn nil, err</span></span>\n<span class="line"><span>\t}</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\tclientSet, err := kubernetes.NewForConfig(restConfig)</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\treturn clientSet, nil</span></span>\n<span class="line"><span>}</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>func main() {</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\tclient, err := buildConfig()</span></span>\n<span class="line"><span>\tif err != nil {</span></span>\n<span class="line"><span>\t\tlog.Fatal(err)</span></span>\n<span class="line"><span>\t}</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\tindexer := cache.Indexers{&quot;name&quot;: func(obj interface{}) ([]string, error) {</span></span>\n<span class="line"><span>\t\tlease, ok := obj.(*apiCoordinationV1.Lease)</span></span>\n<span class="line"><span>\t\tif !ok {</span></span>\n<span class="line"><span>\t\t\treturn nil, nil</span></span>\n<span class="line"><span>\t\t}</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\t\treturn []string{lease.Name}, nil</span></span>\n<span class="line"><span>\t}}</span></span>\n<span class="line"><span>\tinformer := coordinationV1.NewLeaseInformer(client, &quot;kube-system&quot;, 0, indexer)</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\tgo informer.Run(context.Background().Done())</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\ttime.Sleep(time.Second * 5)</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\tlist := informer.GetStore().List()</span></span>\n<span class="line"><span>\tlog.Println(len(list))</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\tleaseObj, err := informer.GetIndexer().ByIndex(&quot;name&quot;, &quot;my-lease&quot;)</span></span>\n<span class="line"><span>\tif err != nil {</span></span>\n<span class="line"><span>\t\tlog.Fatal(err)</span></span>\n<span class="line"><span>\t}</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\tz := *leaseObj[0].(*apiCoordinationV1.Lease)</span></span>\n<span class="line"><span>\tlog.Println(z.Spec.HolderIdentity)</span></span>\n<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lease" tabindex="-1"><a class="header-anchor" href="#lease"><span>lease</span></a></h3><div class="language-golang line-numbers-mode" data-highlighter="shiki" data-ext="golang" data-title="golang" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>package main</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>import (</span></span>\n<span class="line"><span>\t&quot;context&quot;</span></span>\n<span class="line"><span>\t&quot;k8s.io/client-go/util/homedir&quot;</span></span>\n<span class="line"><span>\t&quot;log&quot;</span></span>\n<span class="line"><span>\t&quot;os&quot;</span></span>\n<span class="line"><span>\t&quot;path/filepath&quot;</span></span>\n<span class="line"><span>\t&quot;time&quot;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\tmetaV1 &quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span></span>\n<span class="line"><span>\t&quot;k8s.io/client-go/kubernetes&quot;</span></span>\n<span class="line"><span>\t&quot;k8s.io/client-go/tools/clientcmd&quot;</span></span>\n<span class="line"><span>\t&quot;k8s.io/client-go/tools/leaderelection&quot;</span></span>\n<span class="line"><span>\t&quot;k8s.io/client-go/tools/leaderelection/resourcelock&quot;</span></span>\n<span class="line"><span>)</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>func buildConfig() (*kubernetes.Clientset, error) {</span></span>\n<span class="line"><span>\t// ~/.kube/config</span></span>\n<span class="line"><span>\tvar kubeConfigFile string</span></span>\n<span class="line"><span>\tif home := homedir.HomeDir(); home != &quot;&quot; {</span></span>\n<span class="line"><span>\t\tkubeConfigFile = filepath.Join(home, &quot;.kube&quot;, &quot;config&quot;)</span></span>\n<span class="line"><span>\t}</span></span>\n<span class="line"><span>\trestConfig, err := clientcmd.BuildConfigFromFlags(&quot;&quot;, kubeConfigFile)</span></span>\n<span class="line"><span>\tif err != nil {</span></span>\n<span class="line"><span>\t\treturn nil, err</span></span>\n<span class="line"><span>\t}</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\tclientSet, err := kubernetes.NewForConfig(restConfig)</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\treturn clientSet, nil</span></span>\n<span class="line"><span>}</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>func main() {</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\tvar leaseLockName = &quot;my-lease&quot;</span></span>\n<span class="line"><span>\tvar leaseLockNamespace = &quot;my-namespace&quot;</span></span>\n<span class="line"><span>\tvar id = &quot;lease-holder-name1&quot;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\tclient, err := buildConfig()</span></span>\n<span class="line"><span>\tif err != nil {</span></span>\n<span class="line"><span>\t\tlog.Fatal(err)</span></span>\n<span class="line"><span>\t}</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\t// 我们使用Lease锁类型，因为对租约的编辑不太常见，并且集群中监视“所有租约”的对象较少</span></span>\n<span class="line"><span>\t// 启动领导人选举代码循环</span></span>\n<span class="line"><span>\tleaderelection.RunOrDie(context.Background(), leaderelection.LeaderElectionConfig{</span></span>\n<span class="line"><span>\t\tLock: &amp;resourcelock.LeaseLock{</span></span>\n<span class="line"><span>\t\t\tLeaseMeta: metaV1.ObjectMeta{</span></span>\n<span class="line"><span>\t\t\t\tName:      leaseLockName,</span></span>\n<span class="line"><span>\t\t\t\tNamespace: leaseLockNamespace,</span></span>\n<span class="line"><span>\t\t\t},</span></span>\n<span class="line"><span>\t\t\tClient: client.CoordinationV1(),</span></span>\n<span class="line"><span>\t\t\tLockConfig: resourcelock.ResourceLockConfig{</span></span>\n<span class="line"><span>\t\t\t\tIdentity: id,</span></span>\n<span class="line"><span>\t\t\t},</span></span>\n<span class="line"><span>\t\t},</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\t\t// 设置为true的时候</span></span>\n<span class="line"><span>\t\t// 表示续租或者选举失败的时候</span></span>\n<span class="line"><span>\t\t// 如果当前是leader</span></span>\n<span class="line"><span>\t\t// client-go会自动释放相关资源，如leader election的锁和租约</span></span>\n<span class="line"><span>\t\tReleaseOnCancel: true,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\t\t// 租约持续时间,占据租约后在时间T内占有租约</span></span>\n<span class="line"><span>\t\tLeaseDuration: 6 * time.Second,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\t\t// 续约截止时间,占据租约后,在这个时间段以内重新续约不用参与抢锁</span></span>\n<span class="line"><span>\t\tRenewDeadline: 4 * time.Second,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\t\t// 客户端抢占租约间隔等待时间</span></span>\n<span class="line"><span>\t\tRetryPeriod: 2 * time.Second,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\t\t// 某些生命周期事件期间触发回调</span></span>\n<span class="line"><span>\t\tCallbacks: leaderelection.LeaderCallbacks{</span></span>\n<span class="line"><span>\t\t\tOnStartedLeading: func(ctx context.Context) {</span></span>\n<span class="line"><span>\t\t\t\t// 当前节点成功当选master时触发</span></span>\n<span class="line"><span>\t\t\t\tfunc(ctx context.Context) {</span></span>\n<span class="line"><span>\t\t\t\t\tlog.Println(&quot;i got lease lock,i am leader...&quot;)</span></span>\n<span class="line"><span>\t\t\t\t\tselect {}</span></span>\n<span class="line"><span>\t\t\t\t}(context.Background())</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\t\t\t},</span></span>\n<span class="line"><span>\t\t\tOnStoppedLeading: func() {</span></span>\n<span class="line"><span>\t\t\t\t// 当前节点失去master资格时触发</span></span>\n<span class="line"><span>\t\t\t\tlog.Printf(&quot;leader lost: %s\\n&quot;, id)</span></span>\n<span class="line"><span>\t\t\t\tos.Exit(0)</span></span>\n<span class="line"><span>\t\t\t},</span></span>\n<span class="line"><span>\t\t\tOnNewLeader: func(identity string) {</span></span>\n<span class="line"><span>\t\t\t\t// 集群中选出了master时触发</span></span>\n<span class="line"><span>\t\t\t\tif identity == id {</span></span>\n<span class="line"><span>\t\t\t\t\treturn</span></span>\n<span class="line"><span>\t\t\t\t}</span></span>\n<span class="line"><span>\t\t\t\tlog.Printf(&quot;new leader elected: %s\\n&quot;, identity)</span></span>\n<span class="line"><span>\t\t\t},</span></span>\n<span class="line"><span>\t\t},</span></span>\n<span class="line"><span>\t})</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\tlog.Println(&quot;lease done&quot;)</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>\ttime.Sleep(time.Hour)</span></span>\n<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="一些工具库" tabindex="-1"><a class="header-anchor" href="#一些工具库"><span>一些工具库</span></a></h3><div class="language-golang line-numbers-mode" data-highlighter="shiki" data-ext="golang" data-title="golang" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>ctx := context.Background()</span></span>\n<span class="line"><span>wait.Until(func() {</span></span>\n<span class="line"><span>\t// 无限循环</span></span>\n<span class="line"><span>\tlog.Println(2)</span></span>\n<span class="line"><span>}, time.Second*2, ctx.Done())</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>ctx, cancel := context.WithCancel(ctx)</span></span>\n<span class="line"><span>i := 1</span></span>\n<span class="line"><span>wait.JitterUntil(func() {</span></span>\n<span class="line"><span>\t// 循环至i=5</span></span>\n<span class="line"><span>\ti++</span></span>\n<span class="line"><span>\tif i == 3 {</span></span>\n<span class="line"><span>\t\treturn</span></span>\n<span class="line"><span>\t}</span></span>\n<span class="line"><span>\tlog.Println(i)</span></span>\n<span class="line"><span>\tif i == 5 {</span></span>\n<span class="line"><span>\t\tcancel()</span></span>\n<span class="line"><span>\t}</span></span>\n<span class="line"><span>}, time.Second*2, 1.2, true, ctx.Done())</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',6)]))}]]),p=JSON.parse('{"path":"/posts/kubernetes/%E5%88%9B%E5%BB%BAinformer.html","title":"","lang":"zh-CN","frontmatter":{"hide":true,"description":"lease infomer lease 一些工具库","gitInclude":[],"head":[["meta",{"property":"og:url","content":"https://weiqiangxu.github.io/posts/kubernetes/%E5%88%9B%E5%BB%BAinformer.html"}],["meta",{"property":"og:site_name","content":"QuickStart程序员"}],["meta",{"property":"og:description","content":"lease infomer lease 一些工具库"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"xuweiqiang\\",\\"url\\":\\"https://weiqiangxu.github.io\\"}]}"]]},"headers":[{"level":3,"title":"lease infomer","slug":"lease-infomer","link":"#lease-infomer","children":[]},{"level":3,"title":"lease","slug":"lease","link":"#lease","children":[]},{"level":3,"title":"一些工具库","slug":"一些工具库","link":"#一些工具库","children":[]}],"readingTime":{"minutes":1.83,"words":550},"filePathRelative":"posts/kubernetes/创建informer.md","excerpt":"<h3>lease infomer</h3>\\n<div class=\\"language-golang line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"golang\\" data-title=\\"golang\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span>package main</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>import (</span></span>\\n<span class=\\"line\\"><span>\\t\\"context\\"</span></span>\\n<span class=\\"line\\"><span>\\tapiCoordinationV1 \\"k8s.io/api/coordination/v1\\"</span></span>\\n<span class=\\"line\\"><span>\\tcoordinationV1 \\"k8s.io/client-go/informers/coordination/v1\\"</span></span>\\n<span class=\\"line\\"><span>\\t\\"k8s.io/client-go/kubernetes\\"</span></span>\\n<span class=\\"line\\"><span>\\t\\"k8s.io/client-go/tools/cache\\"</span></span>\\n<span class=\\"line\\"><span>\\t\\"k8s.io/client-go/tools/clientcmd\\"</span></span>\\n<span class=\\"line\\"><span>\\t\\"k8s.io/client-go/util/homedir\\"</span></span>\\n<span class=\\"line\\"><span>\\t\\"log\\"</span></span>\\n<span class=\\"line\\"><span>\\t\\"path/filepath\\"</span></span>\\n<span class=\\"line\\"><span>\\t\\"time\\"</span></span>\\n<span class=\\"line\\"><span>)</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>func buildConfig() (*kubernetes.Clientset, error) {</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>\\tvar kubeConfigFile string</span></span>\\n<span class=\\"line\\"><span>\\tif home := homedir.HomeDir(); home != \\"\\" {</span></span>\\n<span class=\\"line\\"><span>\\t\\tkubeConfigFile = filepath.Join(home, \\".kube\\", \\"config\\")</span></span>\\n<span class=\\"line\\"><span>\\t}</span></span>\\n<span class=\\"line\\"><span>\\trestConfig, err := clientcmd.BuildConfigFromFlags(\\"\\", kubeConfigFile)</span></span>\\n<span class=\\"line\\"><span>\\tif err != nil {</span></span>\\n<span class=\\"line\\"><span>\\t\\treturn nil, err</span></span>\\n<span class=\\"line\\"><span>\\t}</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>\\tclientSet, err := kubernetes.NewForConfig(restConfig)</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>\\treturn clientSet, nil</span></span>\\n<span class=\\"line\\"><span>}</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>func main() {</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>\\tclient, err := buildConfig()</span></span>\\n<span class=\\"line\\"><span>\\tif err != nil {</span></span>\\n<span class=\\"line\\"><span>\\t\\tlog.Fatal(err)</span></span>\\n<span class=\\"line\\"><span>\\t}</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>\\tindexer := cache.Indexers{\\"name\\": func(obj interface{}) ([]string, error) {</span></span>\\n<span class=\\"line\\"><span>\\t\\tlease, ok := obj.(*apiCoordinationV1.Lease)</span></span>\\n<span class=\\"line\\"><span>\\t\\tif !ok {</span></span>\\n<span class=\\"line\\"><span>\\t\\t\\treturn nil, nil</span></span>\\n<span class=\\"line\\"><span>\\t\\t}</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>\\t\\treturn []string{lease.Name}, nil</span></span>\\n<span class=\\"line\\"><span>\\t}}</span></span>\\n<span class=\\"line\\"><span>\\tinformer := coordinationV1.NewLeaseInformer(client, \\"kube-system\\", 0, indexer)</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>\\tgo informer.Run(context.Background().Done())</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>\\ttime.Sleep(time.Second * 5)</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>\\tlist := informer.GetStore().List()</span></span>\\n<span class=\\"line\\"><span>\\tlog.Println(len(list))</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>\\tleaseObj, err := informer.GetIndexer().ByIndex(\\"name\\", \\"my-lease\\")</span></span>\\n<span class=\\"line\\"><span>\\tif err != nil {</span></span>\\n<span class=\\"line\\"><span>\\t\\tlog.Fatal(err)</span></span>\\n<span class=\\"line\\"><span>\\t}</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>\\tz := *leaseObj[0].(*apiCoordinationV1.Lease)</span></span>\\n<span class=\\"line\\"><span>\\tlog.Println(z.Spec.HolderIdentity)</span></span>\\n<span class=\\"line\\"><span>}</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}')}}]);