"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5228],{6262:(s,i)=>{i.A=(s,i)=>{const a=s.__vccOpts||s;for(const[s,n]of i)a[s]=n;return a}},2887:(s,i,a)=>{a.r(i),a.d(i,{comp:()=>l,data:()=>k});var n=a(641);const h={},l=(0,a(6262).A)(h,[["render",function(s,i){return(0,n.uX)(),(0,n.CE)("div",null,i[0]||(i[0]=[(0,n.Fv)('<blockquote><p>使用 openvswitch bridge 和 veth pair 实现两个网络命名空间下的网卡通信</p></blockquote><h3 id="创建-veth-pair-和-ovs-br" tabindex="-1"><a class="header-anchor" href="#创建-veth-pair-和-ovs-br"><span>创建 veth-pair 和 ovs-br</span></a></h3><blockquote><p>OVS 是第三方开源的 Bridge，功能比 Linux Bridge 要更强大，对于同样的实验，我们用 OVS 来看看是什么效果</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 用 ovs 提供的命令创建一个 ovs bridge</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-vsctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add-br</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-br</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看 ovs bridge</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-vsctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> show</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建两对 veth-pair</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 用于创建一个虚拟以太网接口ovs-veth-a，并生成一个与之相连的对等接口ovs-veth-b</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 用于连接Open vSwitch网络交换机</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> veth</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> peer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-b</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> veth</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> peer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-d</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将 veth-pair 两端分别加入到 ns 和 ovs bridge 中</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> netns</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ns1</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-vsctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add-port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-br</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-b</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ifconfig</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-b</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-b</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> netns</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ns2</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-vsctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add-port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-br</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-d</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 给 ns 中的 veth 配置 IP 并启用</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> netns</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ns1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> addr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.1.1.2/24</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-a</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> netns</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ns1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> a</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> netns</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ns1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> netns</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ns2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> addr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.1.1.3/24</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-c</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> netns</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ns2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> a</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> netns</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ns2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> l</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ovs-veth-c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># veth0 ping veth1</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> netns</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ns1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ping</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10.1.1.3</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PING</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10.1.1.3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (10.1.1.3) 56(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">84</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) bytes of data.</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">64</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.1.1.3:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> icmp_seq=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ttl=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> time=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.586</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ms</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">64</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.1.1.3:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> icmp_seq=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ttl=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> time=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.066</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ms</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/images/veth-ovs.png" alt="veth &amp;&amp; ovs" tabindex="0" loading="lazy"><figcaption>veth &amp;&amp; ovs</figcaption></figure><h3 id="q-a" tabindex="-1"><a class="header-anchor" href="#q-a"><span>Q&amp;A</span></a></h3><ul><li>如何设置路由表</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 在ns1和ns2上分别执行以下命令设置路由表</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> route</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.0.0.0/24</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">veth-pair-nam</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 添加本地子网路由</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> route</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> default</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> via</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10.0.0.1</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 添加默认路由</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 显示网络接口的状态和属性，例如接口名称、MAC地址、MTU和状态</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> link</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> show</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://www.cnblogs.com/bakari/p/10613710.html" target="_blank" rel="noopener noreferrer">Linux 虚拟网络设备 veth-pair 详解，看这一篇就够了</a></p>',9)]))}]]),k=JSON.parse('{"path":"/posts/network/veth-pair%E5%92%8Covs-bridge%E9%80%9A%E8%AE%AF.html","title":"veth-pair和ovs-bridge通讯","lang":"zh-CN","frontmatter":{"title":"veth-pair和ovs-bridge通讯","tags":["network"],"categories":["network"],"description":"使用 openvswitch bridge 和 veth pair 实现两个网络命名空间下的网卡通信 创建 veth-pair 和 ovs-br OVS 是第三方开源的 Bridge，功能比 Linux Bridge 要更强大，对于同样的实验，我们用 OVS 来看看是什么效果 veth && ovsveth && ovs Q&A 如何设置路由表 Lin...","gitInclude":[],"head":[["meta",{"property":"og:url","content":"https://weiqiangxu.github.io/posts/network/veth-pair%E5%92%8Covs-bridge%E9%80%9A%E8%AE%AF.html"}],["meta",{"property":"og:site_name","content":"笔记本"}],["meta",{"property":"og:title","content":"veth-pair和ovs-bridge通讯"}],["meta",{"property":"og:description","content":"使用 openvswitch bridge 和 veth pair 实现两个网络命名空间下的网卡通信 创建 veth-pair 和 ovs-br OVS 是第三方开源的 Bridge，功能比 Linux Bridge 要更强大，对于同样的实验，我们用 OVS 来看看是什么效果 veth && ovsveth && ovs Q&A 如何设置路由表 Lin..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://weiqiangxu.github.io/images/veth-ovs.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:tag","content":"network"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"veth-pair和ovs-bridge通讯\\",\\"image\\":[\\"https://weiqiangxu.github.io/images/veth-ovs.png\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"xuweiqiang\\",\\"url\\":\\"https://weiqiangxu.github.io\\"}]}"]]},"headers":[{"level":3,"title":"创建 veth-pair 和 ovs-br","slug":"创建-veth-pair-和-ovs-br","link":"#创建-veth-pair-和-ovs-br","children":[]},{"level":3,"title":"Q&A","slug":"q-a","link":"#q-a","children":[]}],"readingTime":{"minutes":1.55,"words":465},"filePathRelative":"posts/network/veth-pair和ovs-bridge通讯.md","excerpt":"<blockquote>\\n<p>使用 openvswitch bridge 和 veth pair 实现两个网络命名空间下的网卡通信</p>\\n</blockquote>\\n<h3>创建 veth-pair 和 ovs-br</h3>\\n<blockquote>\\n<p>OVS 是第三方开源的 Bridge，功能比 Linux Bridge 要更强大，对于同样的实验，我们用 OVS 来看看是什么效果</p>\\n</blockquote>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" data-title=\\"bash\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 用 ovs 提供的命令创建一个 ovs bridge</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-vsctl</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> add-br</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-br</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 查看 ovs bridge</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-vsctl</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> show</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 创建两对 veth-pair</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 用于创建一个虚拟以太网接口ovs-veth-a，并生成一个与之相连的对等接口ovs-veth-b</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 用于连接Open vSwitch网络交换机</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> link</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> add</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-a</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> type</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> veth</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> peer</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> name</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-b</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> link</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> add</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-c</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> type</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> veth</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> peer</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> name</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-d</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 将 veth-pair 两端分别加入到 ns 和 ovs bridge 中</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> link</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> set</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-a</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> netns</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ns1</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-vsctl</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> add-port</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-br</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-b</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ifconfig</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-b</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> link</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> set</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-b</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> up</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> link</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> set</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-c</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> netns</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ns2</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-vsctl</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> add-port</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-br</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-d</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> link</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> set</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-d</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> up</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># 给 ns 中的 veth 配置 IP 并启用</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> netns</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> exec</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ns1</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> addr</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> add</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> 10.1.1.2/24</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> dev</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-a</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> netns</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> exec</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ns1</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> a</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> netns</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> exec</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ns1</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> link</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> set</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-a</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> up</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> netns</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> exec</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ns2</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> addr</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> add</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> 10.1.1.3/24</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> dev</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-c</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> netns</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> exec</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ns2</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> a</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> netns</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> exec</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ns2</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> l</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> s</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ovs-veth-c</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> up</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\"># veth0 ping veth1</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">$</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ip</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> netns</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> exec</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ns1</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ping</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> 10.1.1.3</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">PING</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> 10.1.1.3</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\"> (10.1.1.3) 56(</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">84</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">) bytes of data.</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">64</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> bytes</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> from</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> 10.1.1.3:</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> icmp_seq=</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\">1</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ttl=</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\">64</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> time=</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\">0.586</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ms</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">64</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> bytes</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> from</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> 10.1.1.3:</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> icmp_seq=</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\">2</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ttl=</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\">64</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> time=</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\">0.066</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> ms</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}')}}]);