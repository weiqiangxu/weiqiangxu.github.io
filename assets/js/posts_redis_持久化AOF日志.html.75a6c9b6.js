"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8290],{6262:(e,i)=>{i.A=(e,i)=>{const s=e.__vccOpts||e;for(const[e,a]of i)s[e]=a;return s}},136:(e,i,s)=>{s.r(i),s.d(i,{comp:()=>l,data:()=>d});var a=s(641);const n={},l=(0,s(6262).A)(n,[["render",function(e,i){return(0,a.uX)(),(0,a.CE)("div",null,i[0]||(i[0]=[(0,a.Fv)('<h3 id="aof-append-only-file-日志" tabindex="-1"><a class="header-anchor" href="#aof-append-only-file-日志"><span>AOF(Append Only File)日志</span></a></h3><h3 id="原理" tabindex="-1"><a class="header-anchor" href="#原理"><span>原理</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>执行写命令完成后会记录日志到硬盘</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="如何开启" tabindex="-1"><a class="header-anchor" href="#如何开启"><span>如何开启</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># redis.conf</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>appendonly yes                    //是否开启AOF持久化 </span></span>\n<span class="line"><span>appendfilename &quot;appendonly.aof&quot;   //AOF持久化文件名</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="为啥不在写命令执行前记录日志而是写命令执行之后呢" tabindex="-1"><a class="header-anchor" href="#为啥不在写命令执行前记录日志而是写命令执行之后呢"><span>为啥不在写命令执行前记录日志而是写命令执行之后呢</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>不阻塞写操作</span></span>\n<span class="line"><span>检查开销</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="在写命令执行后记录日志有什么风险呢" tabindex="-1"><a class="header-anchor" href="#在写命令执行后记录日志有什么风险呢"><span>在写命令执行后记录日志有什么风险呢</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>丢失风险</span></span>\n<span class="line"><span>主进程(执行命令\\写日志) 阻塞 [下一个] 命令</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="对风险消除的措施-写回硬盘策略变更-redis-conf-appendfsync" tabindex="-1"><a class="header-anchor" href="#对风险消除的措施-写回硬盘策略变更-redis-conf-appendfsync"><span>对风险消除的措施 - 写回硬盘策略变更 redis.conf.appendfsync</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>Always   同步写回[最不可能丢数据]</span></span>\n<span class="line"><span>Everysec 每秒写回来[可能丢失1s数据]</span></span>\n<span class="line"><span>No       操作系统控制写回[性能最好][数据丢失数量可能会很多]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="aof重写机制-应对aof日志文件增长变大的问题" tabindex="-1"><a class="header-anchor" href="#aof重写机制-应对aof日志文件增长变大的问题"><span>AOF重写机制(应对AOF日志文件增长变大的问题)</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>超过阙值64M，最新的 [键值对] 状态，一条命令记录，写完了文件覆盖形式更新AOF日志</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>后台子进程 bgrewriteaof 来完成避免阻塞主进程</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',13)]))}]]),d=JSON.parse('{"path":"/posts/redis/%E6%8C%81%E4%B9%85%E5%8C%96AOF%E6%97%A5%E5%BF%97.html","title":"","lang":"zh-CN","frontmatter":{"hide":true,"description":"AOF(Append Only File)日志 原理 如何开启 为啥不在写命令执行前记录日志而是写命令执行之后呢 在写命令执行后记录日志有什么风险呢 对风险消除的措施 - 写回硬盘策略变更 redis.conf.appendfsync AOF重写机制(应对AOF日志文件增长变大的问题)","gitInclude":[],"head":[["meta",{"property":"og:url","content":"https://weiqiangxu.github.io/posts/redis/%E6%8C%81%E4%B9%85%E5%8C%96AOF%E6%97%A5%E5%BF%97.html"}],["meta",{"property":"og:site_name","content":"QuickStart程序员"}],["meta",{"property":"og:description","content":"AOF(Append Only File)日志 原理 如何开启 为啥不在写命令执行前记录日志而是写命令执行之后呢 在写命令执行后记录日志有什么风险呢 对风险消除的措施 - 写回硬盘策略变更 redis.conf.appendfsync AOF重写机制(应对AOF日志文件增长变大的问题)"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"xuweiqiang\\",\\"url\\":\\"https://weiqiangxu.github.io\\"}]}"]]},"headers":[{"level":3,"title":"AOF(Append Only File)日志","slug":"aof-append-only-file-日志","link":"#aof-append-only-file-日志","children":[]},{"level":3,"title":"原理","slug":"原理","link":"#原理","children":[]},{"level":3,"title":"如何开启","slug":"如何开启","link":"#如何开启","children":[]},{"level":3,"title":"为啥不在写命令执行前记录日志而是写命令执行之后呢","slug":"为啥不在写命令执行前记录日志而是写命令执行之后呢","link":"#为啥不在写命令执行前记录日志而是写命令执行之后呢","children":[]},{"level":3,"title":"在写命令执行后记录日志有什么风险呢","slug":"在写命令执行后记录日志有什么风险呢","link":"#在写命令执行后记录日志有什么风险呢","children":[]},{"level":3,"title":"对风险消除的措施 - 写回硬盘策略变更 redis.conf.appendfsync","slug":"对风险消除的措施-写回硬盘策略变更-redis-conf-appendfsync","link":"#对风险消除的措施-写回硬盘策略变更-redis-conf-appendfsync","children":[]},{"level":3,"title":"AOF重写机制(应对AOF日志文件增长变大的问题)","slug":"aof重写机制-应对aof日志文件增长变大的问题","link":"#aof重写机制-应对aof日志文件增长变大的问题","children":[]}],"readingTime":{"minutes":0.86,"words":257},"filePathRelative":"posts/redis/持久化AOF日志.md","excerpt":"<h3>AOF(Append Only File)日志</h3>\\n<h3>原理</h3>\\n<div class=\\"language- line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"\\" data-title=\\"\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span>执行写命令完成后会记录日志到硬盘</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div>","autoDesc":true}')}}]);